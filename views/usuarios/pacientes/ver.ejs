<% include  ../../view_distribution/top1.ejs%>


<% include  ../../view_distribution/top2.ejs%>
<% include  ../../view_distribution/sidebar-left.ejs%>
<%

%>

<style type="text/css">
header h1{
  text-align: center;
  font-weight: bold;
  margin-top: 0;
}
  
 header p{
   text-align: center;
   margin-bottom: 0;
 }

.hexa{
  border: 0px;
  float: left;
  text-align: center;
  height: 35px;
  width: 60px;
  font-size: 22px;
  background: #f0f0f0;
  color: #3c3c3c;
  position: relative;
  margin-top: 15px;
}

.hexa:before{
  content: ""; 
  position: absolute; 
  left: 0; 
  width: 0; 
  height: 0;
  border-bottom: 15px solid #f0f0f0;
  border-left: 30px solid transparent;
  border-right: 30px solid transparent;
  top: -15px;
}

.hexa:after{
  content: ""; 
  position: absolute; 
  left: 0; 
  width: 0; 
  height: 0;
  border-left: 30px solid transparent;
  border-right: 30px solid transparent;
  border-top: 15px solid #f0f0f0;
  bottom: -15px;
}
.timeline {
  position: relative;
  padding: 0;
  width: 100%;
  margin-top: 20px;
  list-style-type: none;
}

.timeline:before {
  position: absolute;
  left: 50%;
  top: 0;
  content: ' ';
  display: block;
  width: 2px;
  height: 100%;
  margin-left: -1px;
  background: rgb(213,213,213);
  background: -moz-linear-gradient(top, rgba(213,213,213,0) 0%, rgb(213,213,213) 8%, rgb(213,213,213) 92%, rgba(213,213,213,0) 100%);
  background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(30,87,153,1)), color-stop(100%,rgba(125,185,232,1)));
  background: -webkit-linear-gradient(top, rgba(213,213,213,0) 0%, rgb(213,213,213) 8%, rgb(213,213,213) 92%, rgba(213,213,213,0) 100%);
  background: -o-linear-gradient(top, rgba(213,213,213,0) 0%, rgb(213,213,213) 8%, rgb(213,213,213) 92%, rgba(213,213,213,0) 100%);
  background: -ms-linear-gradient(top, rgba(213,213,213,0) 0%, rgb(213,213,213) 8%, rgb(213,213,213) 92%, rgba(213,213,213,0) 100%);
  background: linear-gradient(to bottom, rgba(213,213,213,0) 0%, rgb(213,213,213) 8%, rgb(213,213,213) 92%, rgba(213,213,213,0) 100%);
  z-index: 5;
}

.timeline li {
  padding: 2em 0;
}

.timeline .hexa{
  width: 16px;
  height: 10px;
  position: absolute;
  background: #00c4f3;
  z-index: 5;
  left: 0;
  right: 0;
  margin-left:auto;
  margin-right:auto;
  top: -30px;
  margin-top: 0;
}

.timeline .hexa:before {
  border-bottom: 4px solid #00c4f3;
  border-left-width: 8px;
  border-right-width: 8px;
  top: -4px;
}

.timeline .hexa:after {
  border-left-width: 8px;
  border-right-width: 8px;
  border-top: 4px solid #00c4f3;
  bottom: -4px;
}

.direction-l,
.direction-r {
  float: none;
  width: 100%;
  text-align: center;
}

.flag-wrapper {
  text-align: center;
  position: relative;
}

.flag {
  position: relative;
  display: inline;
  background: rgb(255,255,255);
  font-weight: 600;
  z-index: 15;
  padding: 6px 10px;
  text-align: left;
  border-radius: 5px;
}

.direction-l .flag:after,
.direction-r .flag:after {
  content: "";
  position: absolute;
  left: 50%;
  top: -15px;
  height: 0;
  width: 0;
  margin-left: -8px;
  border: solid transparent;
  border-bottom-color: rgb(255,255,255);
  border-width: 8px;
  pointer-events: none;
}

.direction-l .flag {
  -webkit-box-shadow: -1px 1px 1px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.15);
  -moz-box-shadow: -1px 1px 1px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.15);
  box-shadow: -1px 1px 1px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.15);
}

.direction-r .flag {
  -webkit-box-shadow: 1px 1px 1px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.15);
  -moz-box-shadow: 1px 1px 1px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.15);
  box-shadow: 1px 1px 1px rgba(0,0,0,0.15), 0 0 1px rgba(0,0,0,0.15);
}

.time-wrapper {
  display: block;
  position: relative;
  margin: 4px 0 0 0;
  z-index: 14;
  line-height: 1em;
  vertical-align: middle;
  color: #fff;
}

.direction-l .time-wrapper {
  float: none;
}

.direction-r .time-wrapper {
  float: none;
}

.time {
  background: #00c4f3;
  display: inline-block;
  padding: 8px;
}

.desc {
  position: relative;
  margin: 1em 0 0 0;
  padding: 1em;
  background: rgb(254,254,254);
  -webkit-box-shadow: 0 0 1px rgba(0,0,0,0.20);
  -moz-box-shadow: 0 0 1px rgba(0,0,0,0.20);
  box-shadow: 0 0 1px rgba(0,0,0,0.20);
  z-index: 15;
}

.direction-l .desc,
.direction-r .desc {
  position: relative;
  margin: 1em 1em 0 1em;
  padding: 1em;
  z-index: 15;
}

@media(min-width: 768px){
  .timeline {
    width: 660px;
    margin: 0 auto;
    margin-top: 20px;
  }

  .timeline li:after {
    content: "";
    display: block;
    height: 0;
    clear: both;
    visibility: hidden;
  }
  
  .timeline .hexa {
    left: -28px;
    right: auto;
    top: 8px;
  }

  .timeline .direction-l .hexa {
    left: auto;
    right: -28px;
  }

  .direction-l {
    position: relative;
    width: 310px;
    float: left;
    text-align: right;
  }

  .direction-r {
    position: relative;
    width: 310px;
    float: right;
    text-align: left;
  }

  .flag-wrapper {
    display: inline-block;
  }
  
  .flag {
    font-size: 18px;
  }

  .direction-l .flag:after {
    left: auto;
    right: -16px;
    top: 50%;
    margin-top: -8px;
    border: solid transparent;
    border-left-color: rgb(254,254,254);
    border-width: 8px;
  }

  .direction-r .flag:after {
    top: 50%;
    margin-top: -8px;
    border: solid transparent;
    border-right-color: rgb(254,254,254);
    border-width: 8px;
    left: -8px;
  }

  .time-wrapper {
    display: inline;
    vertical-align: middle;
    margin: 0;
  }

  .direction-l .time-wrapper {
    float: left;
  }

  .direction-r .time-wrapper {
    float: right;
  }

  .time {
    padding: 5px 10px;
  }

  .direction-r .desc {
    margin: 1em 0 0 0.75em;
  }
}

@media(min-width: 992px){
  .timeline {
    width: 800px;
    margin: 0 auto;
    margin-top: 20px;
  }

  .direction-l {
    position: relative;
    width: 380px;
    float: left;
    text-align: right;
  }

  .direction-r {
    position: relative;
    width: 380px;
    float: right;
    text-align: left;
  }
}
.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 80%;
}
  html { font-family:Calibri, Arial, Helvetica, sans-serif; font-size:11pt; background-color:white }
  a.comment-indicator:hover + div.comment { background:#ffd; position:absolute; display:block; border:1px solid black; padding:0.5em }
  a.comment-indicator { background:red; display:inline-block; border:1px solid black; width:0.5em; height:0.5em }
  div.comment { display:none }
  table { border-collapse:collapse; page-break-after:always }
  .gridlines td { border:1px dotted black }
  .gridlines th { border:1px dotted black }
  .b { text-align:center }
  .e { text-align:center }
  .f { text-align:right }
  .inlineStr { text-align:left }
  .n { text-align:right }
  .s { text-align:left }
  td.style0 { vertical-align:bottom; border-bottom:none #000000; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:white }
  th.style0 { vertical-align:bottom; border-bottom:none #000000; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:white }
  td.style1 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style1 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style2 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style2 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style3 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style3 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style4 { vertical-align:middle; border-bottom:2px solid #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style4 { vertical-align:middle; border-bottom:2px solid #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style5 { vertical-align:middle; border-bottom:2px solid #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style5 { vertical-align:middle; border-bottom:2px solid #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style6 { vertical-align:middle; border-bottom:2px solid #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style6 { vertical-align:middle; border-bottom:2px solid #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style7 { vertical-align:top; text-align:center; border-bottom:2px solid #000000 !important; border-top:2px solid #000000 !important; border-left:2px solid #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style7 { vertical-align:top; text-align:center; border-bottom:2px solid #000000 !important; border-top:2px solid #000000 !important; border-left:2px solid #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style8 { vertical-align:top; text-align:center; border-bottom:2px solid #000000 !important; border-top:2px solid #000000 !important; border-left:none #000000; border-right:2px solid #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style8 { vertical-align:top; text-align:center; border-bottom:2px solid #000000 !important; border-top:2px solid #000000 !important; border-left:none #000000; border-right:2px solid #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style9 { vertical-align:top; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #000000 !important; border-left:2px solid #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style9 { vertical-align:top; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #000000 !important; border-left:2px solid #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style10 { vertical-align:top; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style10 { vertical-align:top; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style11 { vertical-align:top; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #000000 !important; border-left:none #000000; border-right:2px solid #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style11 { vertical-align:top; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #000000 !important; border-left:none #000000; border-right:2px solid #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style12 { vertical-align:middle; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style12 { vertical-align:middle; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style13 { vertical-align:middle; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style13 { vertical-align:middle; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style14 { vertical-align:middle; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style14 { vertical-align:middle; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style15 { vertical-align:middle; border-bottom:none #000000; border-top:none #000000; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style15 { vertical-align:middle; border-bottom:none #000000; border-top:none #000000; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style16 { vertical-align:middle; border-bottom:none #000000; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style16 { vertical-align:middle; border-bottom:none #000000; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style17 { vertical-align:middle; border-bottom:none #000000; border-top:none #000000; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style17 { vertical-align:middle; border-bottom:none #000000; border-top:none #000000; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style18 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style18 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style19 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style19 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style20 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style20 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style21 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style21 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style22 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style22 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style23 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style23 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style24 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style24 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style25 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style25 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style26 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style26 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style27 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style27 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style28 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style28 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style29 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style29 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style30 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  th.style30 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  td.style31 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  th.style31 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  td.style32 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  th.style32 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  td.style33 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style33 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style34 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style34 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style35 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style35 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style36 { vertical-align:middle; text-align:center; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style36 { vertical-align:middle; text-align:center; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style37 { vertical-align:middle; text-align:center; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style37 { vertical-align:middle; text-align:center; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style38 { vertical-align:middle; text-align:center; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style38 { vertical-align:middle; text-align:center; border-bottom:none #000000; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style39 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style39 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style40 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style40 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style41 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style41 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:none #000000; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style42 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  th.style42 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  td.style43 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  th.style43 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  td.style44 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  th.style44 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFF00 }
  td.style45 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  th.style45 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  td.style46 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  th.style46 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  td.style47 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  th.style47 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  td.style48 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  th.style48 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  td.style49 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  th.style49 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  td.style50 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  th.style50 { vertical-align:middle; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  td.style51 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  th.style51 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  td.style52 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  th.style52 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  td.style53 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  th.style53 { vertical-align:middle; text-align:center; border-bottom:2px solid #CCCCCC !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; font-weight:bold; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#D9D9D9 }
  td.style54 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  th.style54 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  td.style55 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  th.style55 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  td.style56 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  th.style56 { vertical-align:middle; border-bottom:3px double #000000 !important; border-top:2px solid #CCCCCC !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Calibri'; font-size:11pt; background-color:#D9D9D9 }
  td.style57 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFFFF }
  th.style57 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:3px double #000000 !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFFFF }
  td.style58 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFFFF }
  th.style58 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:3px double #000000 !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFFFF }
  td.style59 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFFFF }
  th.style59 { vertical-align:middle; text-align:center; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:#FFFFFF }
  td.style60 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:2px solid #CCCCCC !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style60 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:2px solid #CCCCCC !important; border-right:none #000000; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  td.style61 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:2px solid #CCCCCC !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  th.style61 { vertical-align:top; border-bottom:3px double #000000 !important; border-top:3px double #000000 !important; border-left:none #000000; border-right:2px solid #CCCCCC !important; color:#000000; font-family:'Arial'; font-size:10pt; background-color:white }
  table.sheet0 col.col0 { width:42pt }
  table.sheet0 col.col1 { width:42pt }
  table.sheet0 col.col2 { width:42pt }
  table.sheet0 col.col3 { width:42pt }
  table.sheet0 col.col4 { width:42pt }
  table.sheet0 col.col5 { width:42pt }
  table.sheet0 col.col6 { width:42pt }
  table.sheet0 col.col7 { width:42pt }
  table.sheet0 col.col8 { width:42pt }
  table.sheet0 col.col9 { width:42pt }
  table.sheet0 col.col10 { width:42pt }
  table.sheet0 col.col11 { width:42pt }
  table.sheet0 tr { height:15pt }
  table.sheet0 tr.row0 { height:16.5pt }
  table.sheet0 tr.row1 { height:25.5pt }
  table.sheet0 tr.row2 { height:25.5pt }
  table.sheet0 tr.row3 { height:38.25pt }
  table.sheet0 tr.row4 { height:16.5pt }
  table.sheet0 tr.row5 { height:15.75pt }
  table.sheet0 tr.row6 { height:16.5pt }
  table.sheet0 tr.row7 { height:25.5pt }
  table.sheet0 tr.row8 { height:16.5pt }
  table.sheet0 tr.row9 { height:16.5pt }
  table.sheet0 tr.row10 { height:16.5pt }
  table.sheet0 tr.row11 { height:16.5pt }
  table.sheet0 tr.row12 { height:16.5pt }
  table.sheet0 tr.row13 { height:16.5pt }
  table.sheet0 tr.row14 { height:51pt }
</style>
<section id="content">
  <div class="container">
    <div class="row">
      <div class="card">
        <!-- <%= user._id %> -->
        <!-- <%= paciente.yyyy_nacimiento %> -->
        <h2 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize;"><%= title%> <%= paciente.nombre %> </h2>
        <div class="card col s12" >
          <div class="row">
            <div class="col m12">
               <div class="row">
                  <div class="col l3 s3">
                     <img  style="border: 6px solid; color: #00bcd4;" src="<%= paciente.foto_perfil != null ? paciente.foto_perfil.location : 'https://cdnmetamedic.s3.amazonaws.com/images/avatar/avatar-7.png' %>" class="center">
                </div> 
                <div class="profile-info-left" style="font-family: Georgia, 'Times New Roman', Times, serif; text-transform: capitalize;">
                    <h4 class="user-name m-t-0"><%= paciente.nombre %> <%= paciente.primer_apellido %></h4>
                </div> 
                <div class="col-md-7" style="font-family: Georgia, 'Times New Roman', Times, serif;">
                <ul class="personal-info">
                  <li><span class="title">Numero Identifiación: </span><span class="text"><%= paciente.username %></span>
                  <li><span class="title">Celular 1:</span><span class="text">
                  <a href=""><%= paciente.celular %></a></span></li>
                  <li><span class="title">Celular 2: </span><span class="text">
                      <a href="">
                        <%= paciente.telefono %>
                      </a></span></li>
                  <li><span class="title">Email: </span><span class="text">
                  <a href=""><%= paciente.email %></a></span></li>
                  <li><span class="title">Fecha Nacimiento: </span><span class="text"><%=paciente.yyyy_nacimiento%>-<%=paciente.mm_nacimiento%>-<%=paciente.dd_nacimiento%></span>
                  </li>
                  <% if(paciente.Sedes[0].nombre === '2020'){ %>                     
                      <div class="input-field col s4">
                        <legend for="ocupacion" style="color: #999">Profesionales-Estudiante</legend>
                        <select name="" id="profeAsig" disabled >  
                          <option value="" selected></option>      
                        </select>
                        <!-- <a class="waves-effect waves-light btn modal-trigger blue waves-light" onclick="remitir()">
                          <i class="material-icons">cached</i>
                          <span style="position: relative; bottom: 4px;"> 
                            reasignación
                        </a> -->
                      </div>
                  <% } %>
                </ul><br>
              </div> 
              </div>  <br>
          </div>  
        </div>

  
      </div>

     <% if(paciente.Sedes[0].nombre === '2020'){ %>
      <% if(casoFallido.length > 0){ %>
        <div class="col s12">
          <ul class="tabs">
            <li class="tab col s3 " ><a href="#test1">Datos Del Paciente</a></li>
            <li class="tab col s2 disabled" ><a href="#test2" >Cargue Documento</a></li>
            <li class="tab col s2 " ><a class="active" href="#test4">Recepcion</a></li>
            <li class="tab col s3 disabled" ><a href="#test3" >Historias Clinicas</a></li>
            <li class="tab col s2 disabled" ><a href="#test5" >Informes</a></li>
          </ul>
        </div><br><br>
      <% }else{%>
      <div class="col s12">
        <ul class="tabs">
          <li class="tab col s3"><a class="active" href="#test1">Datos Del Paciente</a></li>
          <li class="tab col s2 " ><a href="#test2">Cargue Documento</a></li>
          <li class="tab col s2 " ><a href="#test4">Recepcion</a></li>
          <li class="tab col s3 " ><a href="#test3">Historias Clinicas</a></li>
          <li class="tab col s2 " ><a href="#test5">Informes</a></li>
        </ul>
      </div><br><br>
      <% } %>
     <% }else{ %>
      <div class="col s12">
        <ul class="tabs">
          <li class="tab col s3"><a class="active" href="#test1">Datos Del Paciente</a></li>
          <li class="tab col s3 " ><a href="#test2">Cargue Documento</a></li>
          <li class="tab col s3 " ><a href="#test3">Historias Clinicas</a></li>
          <li class="tab col s3 " ><a href="#test6">Informes</a></li>
        </ul>
      </div><br><br>

     <% } %>

        <ul class="collapsible popout" data-collapsible="expandable">
        <div id="test1" class="">
          <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;">
          
            <div class="col s12">
              <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize;">datos del paciente</h4>
              <div class="row"><br><br> 
                <input disabled id="user_id" type="hidden" value="<%= paciente._id%>" class="validate">

                <div class="input-field col m6 s12">
                  <select disabled id="tipo_id" class="validate select browse-select">
                    <option value="" disabled>Elige una opción</option>
                    <option value="CC" <%- paciente.tipo_id == 'CC' ? 'selected' : '' %>>Cédula De Ciudadanía</option>
                    <option value="CE" <%- paciente.tipo_id == 'CE' ? 'selected' : '' %>>Cédula De Extranjería</option>
                    <option value="CD" <%- paciente.tipo_id == 'CD' ? 'selected' : '' %>>Carné Diplomático</option>
                    <option value="PA" <%- paciente.tipo_id == 'PA' ? 'selected' : '' %>>Pasaporte</option>
                    <option value="PE" <%- paciente.tipo_id == 'PE' ? 'selected' : '' %>>Permiso Especial De Permanencia
                    </option>
                    <option value="RC" <%- paciente.tipo_id == 'RC' ? 'selected' : '' %>>Registro Civil</option>
                    <option value="TI" <%- paciente.tipo_id == 'TI' ? 'selected' : '' %>>Tarjeta De Identidad</option>
                    <option value="CN" <%- paciente.tipo_id == 'CN' ? 'selected' : '' %>>Certificado De Nacido Vivo
                    </option>
                    <option value="AS" <%- paciente.tipo_id == 'AS' ? 'selected' : '' %>>Adulto Sin Identificar</option>
                    <option value="MS" <%- paciente.tipo_id == 'MS' ? 'selected' : '' %>>Menor Sin Identificar</option>
                  </select>
                  <label>Tipo de Identifiación: <span style="color:red">*</span></label>
                </div>
                 <div class="input-field col m6 s12">
                  <input disabled id="identificacion" type="text" value="<%= paciente.username %>" class="validate">
                  <label for="identificacion">Número de Identifiación <span style="color:red">*</span></label>
                </div>

              </div>
              <div class="row">


                <div class="input-field col m6 s12">
                  <input  id="primer_nombre" type="text" class="validate" value="<%= paciente.primer_nombre%>" style="font-family: 'Times New Roman', Times, serif;">
                  <label for="primer_nombre">Primer Nombre <span style="color:red">*</span></label>
                </div>
                <div class="input-field col m6 s12">
                  <input  id="segundo_nombre" type="text" class="validate"
                    value="<%= paciente.segundo_nombre || " " %>">
                  <label for="segundo_nombre">Segundo Nombre</label>
                </div>
                <div class="input-field col m6 s12">
                  <input  id="primer_apellido" type="text" class="validate"
                    value="<%= paciente.primer_apellido%>">
                  <label for="primer_apellido">Primer Apellido <span style="color:red">*</span></label>
                </div>
                <div class="input-field col m6 s12">
                  <input  id="segundo_apellido" type="text" class="validate"
                    value="<%= paciente.segundo_apellido%>">
                  <label for="segundo_apellido">Segundo Apellido <span style="color:red">*</span></label>
                </div>
              

              </div>
              <div class="row">
                
                <div class="input-field col m3 s12">
                  <!-- <input  type="text" id="fecha_nacimiento" class="datepicker"
                    value="<%=paciente.dd_nacimiento%>/<%=paciente.mm_nacimiento%>/<%=paciente.yyyy_nacimiento%>"> -->
                    <input disabled id="fecha_nacimiento" type = "text" class="pickerdate"
                    value="<%=paciente.yyyy_nacimiento%>-<%=paciente.mm_nacimiento%>-<%=paciente.dd_nacimiento%>"/> 
                  <label for="fecha_nacimiento"></label>
                </div>
               <div class="input-field col m3 s12">
                                        <input disabled id="edad" type="text" class="validate" value="0 años"
                                            >
                                        <label for="edad">Edad</label>
                                    </div>


                <div class="input-field col m4 s12">
                  <input disabled id="tipEdad" type="text" class="validate" value="Ciclo Vital" >
                  <label for="tipEdad">Rango Edad</label>
                </div>

               <div class="input-field col m2 s12">
                <legend for="ocupacion" style="color: #999">Sexo Biológico</legend>
                  <select  id="genero" class="validate select browse-select">
                    <option value="" disabled>Elige una opción</option>
                    <option value="01" <%- paciente.genero_nacimiento=='01' ? 'selected' : '' %>>Masculino</option>
                    <option value="02" <%- paciente.genero_nacimiento == '02' ? 'selected' : '' %>>Femenino
                    </option>
                    
                    <option value="03"  <%- paciente.genero_nacimiento == '03' ? 'selected' : '' %>>Indeterminado/Intersexual</option>
                  </select>
                </div>
                <div class="input-field col m3 s12">
                  <legend for="ocupacion" style="color: #999">Identidad de Genero</legend>
                    <select  id="isex" class="validate select browse-select">
                        <option value="" disabled selected>Elige una opción</option>
                        <option <%- paciente.identidad_sexual == '01' ? 'selected' : '' %> value="01">Masculino</option>
                        <option <%- paciente.identidad_sexual == '02' ? 'selected' : '' %> value="02">Femenino</option>
                        <option <%- paciente.identidad_sexual == '03' ? 'selected' : '' %> value="03">Transgénero</option>
                        <option <%- paciente.identidad_sexual == '04' ? 'selected' : '' %> value="04">Neutro</option>
                        <option <%- paciente.identidad_sexual == '05' ? 'selected' : '' %> value="05">No lo declara</option>
                        
                    </select>
                </div>
                <div class="input-field col m3 s12">
                  <legend for="ocupacion" style="color: #999">Escolaridad</legend>
                  <select id="escolaridad" class="validate select browse-select" >
                      <option value="" disabled selected>Elige una opción</option>
                      <option <%- paciente.escolaridad == 'Desescolarizado' ? 'selected' : '' %> value="Desescolarizado">Desescolarizado</option>
                      <option <%- paciente.escolaridad == 'Pre-Escolar' ? 'selected' : '' %> value="Pre-Escolar">Pre-Escolar</option>
                      <option <%- paciente.escolaridad == 'Primaria Incompleta' ? 'selected' : '' %> value="Primaria Incompleta">Primaria Incompleta</option>
                      <option <%- paciente.escolaridad == 'Primaria en Curso' ? 'selected' : '' %> value="Primaria en Curso">Primaria en Curso</option>
                      <option <%- paciente.escolaridad == 'Primaria Completa' ? 'selected' : '' %> value="Primaria Completa">Primaria Completa</option>
                      <option <%- paciente.escolaridad == 'Bachiller Bachiller Incompleto' ? 'selected' : '' %> value="Bachiller Bachiller Incompleto">Postgrado</option>
                      <option <%- paciente.escolaridad == 'Bachiller en Curso' ? 'selected' : '' %> value="Bachiller en Curso">Bachiller en Curso</option>
                      <option <%- paciente.escolaridad == 'Bachiller Técnico Incompleto' ? 'selected' : '' %> value="Bachiller Técnico Incompleto">Bachiller Técnico Incompleto</option>
                      <option <%- paciente.escolaridad == 'Bachiller Completo' ? 'selected' : '' %> value="Bachiller Completo">Bachiller Completo</option>
                      <option <%- paciente.escolaridad == 'Técnico en Curso' ? 'selected' : '' %> value="Técnico en Curso">Técnico en Curso</option>
                      <option <%- paciente.escolaridad == 'Técnico' ? 'selected' : '' %> value="Técnico">Técnico</option>
                      <option <%- paciente.escolaridad == 'Tecnólogo Incompleto' ? 'selected' : '' %> value="Tecnólogo Incompleto">Técnico Tecnólogo Incompleto</option>
                      <option <%- paciente.escolaridad == 'Tecnólogo en Curso' ? 'selected' : '' %> value="Tecnólogo en Curso">Tecnólogo en Curso</option>
                      <option <%- paciente.escolaridad == 'Tecnólogo' ? 'selected' : '' %> value="Tecnólogo">Tecnólogo</option>
                      <option <%- paciente.escolaridad == 'Universitario Incompleto' ? 'selected' : '' %> value="Universitario Incompleto">Universitario Incompleto</option>
                      <option <%- paciente.escolaridad == 'Universitario en Curso' ? 'selected' : '' %> value="Universitario en Curso">Universitario en Curso</option>
                      <option <%- paciente.escolaridad == 'Profesional (Título)' ? 'selected' : '' %> value="Profesional (Título)">Profesional (Título)</option>
                      <option <%- paciente.escolaridad == 'Profesional (Título)' ? 'selected' : '' %> value="Profesional (Título)">Profesional (Título)</option>
                      <option <%- paciente.escolaridad == 'Especialización' ? 'selected' : '' %> value="Especialización">Especialización</option>
                      <option <%- paciente.escolaridad == 'Maestría' ? 'selected' : '' %> value="Maestría">Maestría</option>
                      <option <%- paciente.escolaridad == 'Doctorado' ? 'selected' : '' %> value="Doctorado">Doctorado</option>
                      <option <%- paciente.escolaridad == 'PosDoctorado' ? 'selected' : '' %> value="PosDoctorado">PosDoctorado</option>
                  </select>
                  </div>
                 <div class="input-field col m3 s12">
                  <!-- <input  id="ocupacion" type="text" class="validate" value="<%# paciente.ocupacion %>"> -->
                  <legend for="ocupacion" style="color: #999">Ocupación</legend>
                  <select id="ocupacion" class="validate select browse-select">
                    <option value="" disabled selected>Elige una opción</option>
                   <!--  <option value="Desempleado(a)"<%# paciente.ocupacion == 'Desempleado(a)' ? 'selected' : '' %>>Desempleado(a)</option>
                    <option value="Trabajador(a) Informal"<%# paciente.ocupacion == 'Trabajador(a) Informal' ? 'selected' : '' %>>Trabajador(a) Informal</option>
                    <option value="Ama(o) de Casa"<%# paciente.ocupacion == 'Ama(o) de Casa' ? 'selected' : '' %>>Ama(o) de Casa</option>
                    <option value="Trabajador(a) Independiente"<%# paciente.ocupacion == 'Trabajador(a) Independiente' ? 'selected' : '' %>>Trabajador(a) Independiente</option>
                    <option value="Empleado(a)"<%# paciente.ocupacion == 'Empleado(a)' ? 'selected' : '' %>>Empleado(a)</option>
                    <option value=" Empleado(a) USTA"<%# paciente.ocupacion == ' Empleado(a) USTA' ? 'selected' : '' %>> Empleado(a) USTA</option>
                    <option value="Funcionario(a) Público(a)"<%# paciente.ocupacion == 'Funcionario(a) Público(a)' ? 'selected' : '' %>>Funcionario(a) Público(a)</option>
                    <option value="Pensionado(a)"<%# paciente.ocupacion == 'Pensionado(a)' ? 'selected' : '' %>>Pensionado(a)</option>
                    <option value="Estudiante"<%# paciente.ocupacion == 'Estudiante' ? 'selected' : '' %>>Estudiante</option>
                    <option value="Estudiante USTA"<%# paciente.ocupacion == 'Estudiante USTA' ? 'selected' : '' %>>Estudiante USTA</option> -->
                </select>
                </div>


                <div class="input-field col m3 s12">
                  <legend for="ocupacion" style="color: #999">Estado Civil</legend>
                  <select  id="estado_civil" class="validate select browse-select">
                    <option value="" disabled selected>Elige una opción</option>
                    <option value="soltero" <%- paciente.estado_civil == 'soltero' ? 'selected' : '' %>>Soltero(a)
                    </option>
                    <option value="casado" <%- paciente.estado_civil == 'casado' ? 'selected' : '' %>>Casado(a)</option>
                    <option value="union_libre" <%- paciente.estado_civil == 'union_libre' ? 'selected' : '' %>>Unión
                      libre</option>
                    <option value="separado" <%- paciente.estado_civil == 'separado' ? 'selected' : '' %>>Separado(a)
                    </option>
                    <option value="divorciado" <%- paciente.estado_civil == 'divorciado' ? 'selected' : '' %>>
                      Divorciado(a)</option>
                    <option value="viudo" <%- paciente.estado_civil == 'viudo' ? 'selected' : '' %>>Viudo(a)</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="input-field col m4 s12">
                  <input value="<%= paciente.email %>"  id="email" type="email" class="validate">
                  <label for="email">Email <span style="color:red">*</span></label>
                </div>
                <div class="input-field col m4 s12">
                  <input  id="phone" name="phone" type="tel" value="+<%= paciente.telefono %>">
                  <!-- <label for="phone">Teléfono: </label> -->
                </div>
                <div class="input-field col m4 s12">
                  <input  id="cell" name="cell" type="tel" value="+<%= paciente.celular %>">
                  <!-- <label for="phone">Celular: </label> -->
                </div>
              </div>

            </div>
            
          
          <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;"/>

                        <div class="col s12">
                          <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize;">Dirección</h4>
                            <div class="row"><br><br>
                                <div class="input-field col m3 s12">
                                      <select  id="pais"
                                        class="validate select browse-select membresia_precio_calc ">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <% 
                                       
                                        for (let i = 0; i < paises.length; i++) {
                                            const pais = paises[i]; %>
                                            <option <%- paciente.pais == pais.name  ? 'selected' : '' %>  value="<%= pais.name %>"><%= pais.name %></option>
                                        <% } %>
                                    </select>
                                    <label for="pais">Pais <span style="color:red">*</span></label>
                                </div>
                                <div class="input-field col m3 s12">
                                    
                            <%if (paciente.pais =="Colombia") { %>
       
                                    <div id="ocultar_departamento">
                                    <select  id="departamento"
                                        class="validate select browse-select membresia_precio_calc">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <% 
                                        departamentos.sort(function (a, b) {
                                            if (a.Nombre > b.Nombre) {
                                                return 1
                                            } else if (a.Nombre < b.Nombre) {
                                                return -1
                                            } else {
                                                return 0
                                            }
                                        })
                                        for (let i = 0; i < departamentos.length; i++) {
                                            const depa = departamentos[i]; %>
                                            <option <%- paciente.departamento == depa.Codigo  ? 'selected' : '' %> value="<%= depa.Codigo %>"><%= depa.Nombre %></option>
                                        <% } %>
                                    </select>
                                    <label for="departamento">Departamento <span style="color:red">*</span></label>
                                  </div>
                              <% } else if (paciente.pais =="Ecuador") { %>
                                <div class="provincia">
                                  <select  id="provincia">
                                      <option value="" disabled selected>Elige una opción </option>
                                      <%
                                      provincia.sort(function (a, b) {
                                          if (a.Nombre > b.Nombre) {
                                              return 1
                                          } else if (a.Nombre < b.Nombre) {
                                              return -1
                                          } else {
                                              return 0
                                          }
                                      })
                                      for (let i = 0; i < provincia.length; i++){
                                          const prov = provincia[i]; %>
                                          <option <%- paciente.provincia == prov.Codigo  ? 'selected' : '' %> value="<%= prov.Codigo %>"><%= prov.Nombre %></option>

                                      <% } %> 
                                      
                                  </select>
                                  <label for="provincia">provincia <span style="color:red">*</span></label>
                              </div> 

                                <% }
                                else{ %>

                                    <input  id="departamento" type="text" value="<%= paciente.departamento %>" placeholder="Digite su Departamento/Estado"  class="validate departamentosInput departamento1">
                                    <label for="departamento">Departamento <span style="color:red">*</span></label>  

                                <% } %>  
                                   
                                
                                </div>
                                <div class="input-field col m3 s12">
                                 <%if (paciente.pais =="Colombia") { %>
                                     <select  id="municipio"
                                        class="validate select browse-select membresia_precio_calc ">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <%                                       
                                        municipios.sort(function (a, b) {
                                            if (a.Municipio > b.Municipio) {
                                                return 1
                                            } else if (a.Municipio < b.Municipio) {
                                                return -1
                                            } else {
                                                return 0
                                            }
                                        })
                                        for (let i = 0; i < municipios.length; i++) {
                                            const muni = municipios[i]; 
                                            if(muni.Cod_depa == paciente.departamento){ %>
                                              <option <%- paciente.municipio == muni.Cod_muni  ? 'selected' : '' %> value="<%= muni.Cod_muni %>"><%= muni.Municipio %></option>
                                        <% } %>           
                                        <% } %>
                                    </select>
                                    <label for="municipio">Municipio <span style="color:red">*</span></label>
                                     <% } else if (paciente.pais == 'Ecuador'){ %>
                                      <div id="canton_select">
                                        <select class="" id="canton">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <% 
                                        canton.sort(function (a, b) {
                                          if (a.cantones > b.cantones) {
                                              return 1
                                          } else if (a.cantones < b.cantones) { return -1 } else { return 0 } }) %>
                                            
                                            <%
                                            for (let i = 0; i < canton.length; i++){
                                                const can = canton[i]; %>
                                                
                                                <option <%- paciente.canton == can.Codigo_cat ? 'selected' : '' %>  value="<%= can.Codigo_cat %>"><%= can.canton_name %></option>
        
                                            <% } %>  
                                            
                                        </select>
                                        <label for="canton">canton <span style="color:red">*</span></label>
                                        
                                        </div>
                                        

                                   <%  }
                                else{ %>

                                    <input  id="municipio" type="text" value="<%= paciente.municipio %>" placeholder="Digite su Municipio/Ciudad"  class="municipio">
                                    <label for="municipio">Municipio <span style="color:red">*</span></label>
                                <% } %>   
                                    
                                    
                                </div>
                                <div class="input-field col m3 s12">
                                    <%if (paciente.municipio =="001" && paciente.departamento=="11") { %>
                                    <select  id="localidad"
                                        class="validate select browse-select membresia_precio_calc localidadSelect2 localidad0">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option <%- paciente.localidad == 'Usaquén' ? 'selected' : '' %> value="Usaquén">Usaquén</option>
                                        <option <%- paciente.localidad == 'Chapinero' ? 'selected' : '' %> value="Chapinero">Chapinero</option>
                                        <option <%- paciente.localidad == 'Santafé' ? 'selected' : '' %> value="Santafé">Santafé</option>
                                        <option <%- paciente.localidad == 'San Cristobal' ? 'selected' : '' %> value="San Cristobal">San Cristobal</option>
                                        <option <%- paciente.localidad == 'Usme' ? 'selected' : '' %> value="Usme">Usme</option>
                                        <option <%- paciente.localidad == 'Tunjuelito' ? 'selected' : '' %> value="Tunjuelito">Tunjuelito</option>
                                        <option <%- paciente.localidad == 'Bosa' ? 'selected' : '' %> value="Bosa">Bosa</option>
                                        <option <%- paciente.localidad == 'Kennedy' ? 'selected' : '' %> value="Kennedy">Kennedy</option>
                                        <option <%- paciente.localidad == 'Fontibón' ? 'selected' : '' %> value="Fontibón">Fontibón</option>
                                        <option <%- paciente.localidad == 'Engativá' ? 'selected' : '' %> value="Engativá">Engativá</option>
                                        <option <%- paciente.localidad == 'Suba' ? 'selected' : '' %> value="Suba">Suba</option>
                                        <option <%- paciente.localidad == 'Barrios Unidos' ? 'selected' : '' %> value="Barrios Unidos">Barrios Unidos</option>
                                        <option <%- paciente.localidad == 'Teusaquillo' ? 'selected' : '' %> value="Teusaquillo">Teusaquillo</option>
                                        <option <%- paciente.localidad == 'Los Mártires' ? 'selected' : '' %> value="Los Mártires">Los Mártires</option>
                                        <option <%- paciente.localidad == 'Antonio Nariño' ? 'selected' : '' %> value="Antonio Nariño">Antonio Nariño</option>
                                        <option <%- paciente.localidad == 'Puente Aranda' ? 'selected' : '' %> value="Puente Aranda">Puente Aranda</option>
                                        <option <%- paciente.localidad == 'La Candelaria' ? 'selected' : '' %> value="La Candelaria">La Candelaria</option>
                                        <option <%- paciente.localidad == 'Rafael Uribe Uribe' ? 'selected' : '' %> value="Rafael Uribe Uribe">Rafael Uribe Uribe</option>
                                        <option <%- paciente.localidad == 'Ciudad Bolivar' ? 'selected' : '' %> value="Ciudad Bolivar">Ciudad Bolivar</option>
                                        <option <%- paciente.localidad == 'Sumapaz' ? 'selected' : '' %> value="Sumapaz">Sumapaz</option>
                                        <option <%- paciente.localidad == 'Municipios' ? 'selected' : '' %> value="Municipios">Municipios</option>
                                    </select>
                                     <% }
                                else{ %>

                                    <input  id="localidad" type="text" value="<%= paciente.localidad %>" placeholder="Digite su Localidad"  class="validate localidad1">

                                <% } %>  
                                    <label for="localidad">Localidad</label>
                                </div>
                                <div class="input-field col m7 s11 ">
                                    <textarea id="direccion" class="materialize-textarea" data-length="120" ><%= paciente.direccion %></textarea>
                                    <label for="direccion">Dirección</label>
                                </div>
                                <div class="input-field col m2 s12" style="    margin-top: 51px;">
                                    <select  id="zona" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option <%- paciente.zona == 'rural' ? 'selected' : '' %> value="rural">Rural</option>
                                        <option <%- paciente.zona == 'urbana' ? 'selected' : '' %> value="urbana">Urbana</option>
                                        <option <%- paciente.zona == 'Otro' ? 'selected' : '' %> value="Otro">Otro</option>
                                    </select>
                                    <label>Zona</label>
                                </div>
                                <div class="input-field col m2 s12" style="    margin-top: 51px;">
                                    <select   id="estrato" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option <%- paciente.estrato == '1' ? 'selected' : '' %> value="1">1</option>
                                        <option <%- paciente.estrato == '2' ? 'selected' : '' %> value="2">2</option>
                                        <option <%- paciente.estrato == '3' ? 'selected' : '' %> value="3">3</option>
                                        <option <%- paciente.estrato == '4' ? 'selected' : '' %> value="4">4</option>
                                        <option <%- paciente.estrato == '5' ? 'selected' : '' %> value="5">5</option>
                                        <option <%- paciente.estrato == '6' ? 'selected' : '' %> value="6">6</option>
                                    </select>
                                    <label>Estrato</label>
                                </div>
                            </div>
                        </div>

          <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;"/>    
                    <% if(paciente.pais == 'Colombia'){ %>
                    
                        <div class="col s12">
                          <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize;">Datos de afiliación</h4>
                            <div class="row"><br>
                                <div class="input-field col m6 s12">
                                  <legend for="ocupacion" style="color: #999">RH</legend>
                                    <select  id="rh" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option <%- paciente.rh == 'A+' ? 'selected' : '' %> value="A+">A+</option>
                                        <option <%- paciente.rh == 'A-' ? 'selected' : '' %> value="A-">A-</option>
                                        <option <%- paciente.rh == 'B+' ? 'selected' : '' %> value="B+">B+</option>
                                        <option <%- paciente.rh == 'B-' ? 'selected' : '' %> value="B-">B-</option>
                                        <option <%- paciente.rh == 'O+' ? 'selected' : '' %> value="O+">O+</option>
                                        <option <%- paciente.rh == 'O-' ? 'selected' : '' %> value="O-">O-</option>
                                        <option <%- paciente.rh == 'AB+' ? 'selected' : '' %> value="AB+">AB+</option>
                                        <option <%- paciente.rh == 'AB-' ? 'selected' : '' %> value="AB-">AB-</option>
                                    </select>
                                </div>
                                <div class="input-field col m6 s12">
                                  <legend for="ocupacion" style="color: #999">Régimen de Salud</legend>
                                    <select  id="regimen_salud" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option <%- paciente.regimen_salud == '1' ? 'selected' : '' %> value="1">Contributivo</option>
                                        <option <%- paciente.regimen_salud == '2' ? 'selected' : '' %> value="2">Subsidiado</option>
                                        <option <%- paciente.regimen_salud == '3' ? 'selected' : '' %> value="3">Vinculado</option>
                                        <option <%- paciente.regimen_salud == '4' ? 'selected' : '' %> value="4">Particular</option>
                                        <option <%- paciente.regimen_salud == '5' ? 'selected' : '' %> value="5">Otro</option>
                                        <option <%- paciente.regimen_salud == '6' ? 'selected' : '' %> value="6">Víctima con afiliación al Régimen Contributivo</option>
                                        <option <%- paciente.regimen_salud == '7' ? 'selected' : '' %> value="7">Víctima con afiliación al Régimen subsidiado</option>
                                        <option <%- paciente.regimen_salud == '8' ? 'selected' : '' %> value="8">Víctima no asegurado (Vinculado)</option>
                                    </select>
                                </div>
                                <div class="input-field col m6 s12">
                                  <legend for="ocupacion" style="color: #999">EPS</legend>
                                      <select  id="eps"
                                        class="validate select browse-select membresia_precio_calc ">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <% 
                                        eps.sort(function (a, b) {
                                            if (a.name > b.name) {
                                                return 1
                                            } else if (a.name < b.name) {
                                                return -1
                                            } else {
                                                return 0
                                            }
                                        })
                                        for (let i = 0; i < eps.length; i++) {
                                            const epsi = eps[i]; %>
                                            <option <%- paciente.eps == epsi.code  ? 'selected' : '' %> value="<%= epsi.code %>"><%= epsi.code %>: <%= epsi.name %></option>
                                        <% } %>
                                    </select>
                                </div>
                                <div class="input-field col m6 s12">
                                  <legend for="ocupacion" style="color: #999">Pertenencia Étnica</legend>
                                    <select   id="pertenencia_etnica" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option <%- paciente.pertenencia_etnica=='01' ? 'selected' : '' %> value="01">Indígena</option> Indígena
                                        <option <%- paciente.pertenencia_etnica=='02' ? 'selected' : '' %> value="02">ROM(Gitanos)</option> Gitanos
                                        <option <%- paciente.pertenencia_etnica=='03' ? 'selected' : '' %> value="03">Raizal (San Andrés y Providencia)</option> Raizal (San Andrés y Providencia)
                                        <option <%- paciente.pertenencia_etnica=='04' ? 'selected' : '' %> value="04">Palenquero de San Basilio de Palenque</option>Palenquero de San Basilio de Palenque
                                        <option <%- paciente.pertenencia_etnica=='05' ? 'selected' : '' %> value="05">Negro(a) </option> Negro(a)
                                        <option <%- paciente.pertenencia_etnica=='06' ? 'selected' : '' %> value="06">Afrocolombiano</option> Afrocolombiano
                                        <option <%- paciente.pertenencia_etnica=='99' ? 'selected' : '' %> value="99">Ninguna de las Anteriores</option> Afrocolombiano Ninguna de las Anteriores
                                        
                                        
                                        
                                        
                                    </select>
                                </div>
                            </div><br>
                        </div>
                        <div class="row">
                          <div>

                          </div>
                        </div>
          <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;"/> 
                    <% } %>

             

                      <div class="col s12">
                        <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize;">Datos Del Acompañante</h4>
                          <div class="row"><br><br>
                                <div class="input-field col m4 s12">
                                  <select  id="tipo_id_acompanate" class="validate select browse-select">
                                      <option value="" disabled selected>Elige una opción</option>
                                      <option value="CC" <%- paciente.acompanante_tipo_identificacion == 'CC' ? 'selected' : '' %>>Cédula De Ciudadanía</option>
                                      <option value="CE" <%- paciente.acompanante_tipo_identificacion == 'CE' ? 'selected' : '' %>>Cédula De Extranjería</option>
                                      <option value="PA" <%- paciente.acompanante_tipo_identificacion == 'PA' ? 'selected' : '' %>>Pasaporte</option>
                                      <option value="PE" <%- paciente.acompanante_tipo_identificacion == 'PE' ? 'selected' : '' %>>Permiso Especial De Permanencia</option>
                                  </select>
                                  <label for="tipo_id_acompanate">Tipo de Identifiación: <span style="color:red">*</span></label>
                              </div>
                              <div class="input-field col m4 s12">
                                  <input  id="comp_identificacion" type="text" value="<%= paciente.acompanante_identificacion %>"  class="validate">
                                  <label for="comp_identificacion">Número de Identificación <span style="color:red">*</span></label>
                              </div>
                          </div>
                          <div class="row">
                              <input id="user_id" type="hidden" value="<%= user._id%>" class="validate">

                              <div class="input-field col m6 s12">
                                  <input  id="comp_Nombrecompleto" type="text" value="<%= paciente.acompanante_nombre %>" class="validate">
                                  <label for="comp_Nombrecompleto">Nombre Completo <span style="color:red">*</span></label>
                              </div>
                            
                              <div class="input-field col m3 s12">
                                  
                                  <select  id="comp_Parentesco" class="validate select browse-select">
                                    <option value="" disabled selected>Elige una opción</option>
                                    <option value="PA" <%- paciente.acompanante_parentezco == 'PA' ? 'selected' : '' %>>padre - madre</option>
                                    <option value="HI" <%- paciente.acompanante_parentezco == 'HI' ? 'selected' : '' %>>hijo - hija</option>
                                    <option value="ES" <%- paciente.acompanante_parentezco == 'ES' ? 'selected' : '' %>>Esposo - esposa</option>
                                    <option value="AB" <%- paciente.acompanante_parentezco == 'AB' ? 'selected' : '' %>>abuelo abuela</option>
                                    <option value="TI" <%- paciente.acompanante_parentezco == 'TI' ? 'selected' : '' %>>tio - tia</option>
                                    <option value="CU" <%- paciente.acompanante_parentezco == 'CU' ? 'selected' : '' %>>cuidador - cuidadora</option>
                                    <option value="TL" <%- paciente.acompanante_parentezco == 'TL' ? 'selected' : '' %>>tutor legal</option>
                                    <option value="OT" <%- paciente.acompanante_parentezco == 'OT' ? 'selected' : '' %>>Otro</option>
                                  </select>
                                  <label for="comp_Parentesco">Parentesco <span style="color:red">*</span></label>
                              </div>
                              <% if(paciente.acompanante_parentezco == 'OT'){ %>
                               
                              <div class="input-field col m3 s12" id="input_otro">
                                <input id="otro" type="text"  value="<%= paciente.acompanante_parentezco_otro %>" class="validate">  
                                <label for="otro">Otro <span style="color:red">*</span></label>
                              </div>
                              <% } else{ %>
                                <div class="row" id="otroShow">

                                </div>

                             <% } %>
                          </div>
                          <div class="row">
                              <div  class="input-field col m3 s12">
                                  <input  id="comp_telefono" type="number" value="<%= paciente.acompanante_telefono %>" class="validate">
                                  <label for="comp_telefono">Telefono <span style="color:red">*</span></label>
                              </div>

                              <div class="input-field col m4 s12">
                                  <input  id="comp_email" type="email" value="<%= paciente.acompanante_correo %>" class="validate">
                                  <label for="comp_email">Email <span style="color:red">*</span></label>
                              </div>
                          </div>

                          
                      </div>
                    
          <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;"/>            
                    <div class="col s12">
                      <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize;">Permisos</h4>                   
                        <div class="row"><br><br>
                            <div class="col m4 s12">
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="Firma_consInformado" <%= paciente.permisosUsers_FirmaConsentimiento == 1 ? "checked" : false %> >
                                    <label class="form-check-label" for="Firma_consInformado">Firma consentimiento informado</label>
                                </div>
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="Create_Cita" <%= paciente.permisosUsers_CreateCitas == 1 ? "checked" : false  %> >
                                    <label class="form-check-label" for="Create_Cita">Creación de citas</label>
                                </div>
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="download_Certificate" <%= paciente.permisosUsers_DescargaCertificado == 1 ? "checked" : false  %> >
                                    <label class="form-check-label" for="download_Certificate">Descarga de certificados de consulta </label>
                                </div>
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="donwload_Remision" <%= paciente.permisosUsers_DescargaRemisiones == 1 ? "checked" : false  %> >
                                    <label class="form-check-label" for="donwload_Remision">Descarga de remisiones</label>
                                </div>
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="dowload_history" <%= paciente.permisosUsers_DescargaHistorialClinico == 1 ? "checked" : false  %> >
                                    <label class="form-check-label" for="dowload_history">Descarga de historia clinica</label>
                                </div>
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="anexar_documentos" <%= paciente.permisosUsers_AnexarDocumento == 1 ? "checked" : false  %> >
                                    <label class="form-check-label" for="anexar_documentos">Anexar documentos</label>
                                </div>
                                <div class="form-check">
                                    <input   type="checkbox" class="form-check-input" id="autoReportCondition" <%= paciente.permisosUsers_autoreporte == 1 ? "checked" : false  %> >
                                    <label class="form-check-label" for="autoReportCondition">Autoreporte de condiciones de salud</label>
                                </div>
                                <div class="form-check">
                                  <input   type="checkbox" class="form-check-input" id="editDataIfno" <%= paciente.permisosUsers_editarInfo == 1 ? "checked" : false  %> >
                                  <label class="form-check-label" for="editDataIfno">Editar datos del paciente</label>
                              </div>
                            </div>
                            
                        </div>

                        
                    </div>                
          <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;"/>  
          <% if(paciente.Sedes[0].nombre === '2020' && user.roles == 'SP'){ %> 

                <% }else{ %>
                  <div class="col m12 m12 s12 text-center">
                    <button class="col m12 m12 s12 btn waves-effect green waves-light" id="enviar_data">
                        <i class="material-icons">save</i>
                        <span style="position: relative; bottom: 4px;"> Actualizar</span>
                    </button>
                    <hr>
                </div><br>
                <% } %> 
       </div>        
              <% if (paciente.Sedes !== null) {  %>
                <% if(paciente.Sedes[0].nombre === '2020' ){ %>
                  <div id="test4">
                    <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;">  <br>
                    <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize; text-align: center;">Historial De Recepción</h4>                  
                      <div class="row">
                        <table id="tabla_historias" class="bordered highlight responsive-table centered">
                          <thead class="">
                            <tr>
                              <th>Nro.  </th>
                              <th>Fecha De Creación</th>
                              <th>Descargar</th>
                            </tr>
                          </thead>
                          <tbody style="display: contents;" id="tableRecepcion">
                              <% for (let h = 0; h < recepcion.length; h++) {
                                const reception = recepcion[h];  %>
                            <tr>
                              <td><%= h + 1 %></td>
                              <td><%= reception.fechaSystem %></td>
                              <td> <a  class="waves-effect waves-light btn modal-trigger green waves-light" href="#Modalrececion_<%=h%>" ><i class="material-icons">assignment</i> Ver Recepcion</a> 
                                <div class="modal" id="Modalrececion_<%=h%>" style="width: 90%;">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <div class="row">
                                        <form class="col s12">
                                          <div class="row">
                                            <div class="col s6">
                                            </div>
                                            <div class="col s6">                
                                              <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat" style="margin-left: 89%;">
                                                <i class="material-icons">close</i>
                                                <span style="position: relative; bottom: 4px;"> </span>
                                              </a>
                                            </div>
                                          </div>
                                        </form>
                                      </div>
                                    </div>
                                    <div class="row">
                                      <div class="col s12 m6 offset-m3 center">
                                        <h5>
                                          <b>RECEPCIÓN #<%=h+1%></b>
                                        </h5>
                                      </div>
                                    </div>   
                                    <div class="row">
                                      <div class="col s12">
                                        Fecha : <%= moment(reception.fechaSystem).locale('es').format('LLL') %>
                                      </div>
                                    </div><br>
                                    <div class="row">
                                      <div class="col s12">
                                        Caso Remitido: <%= reception.caseRemition%>
                                      </div>
                                    </div>
                                    <% if(reception.caseRemition == 'SI'){ %>

                                    <% } else { %>

                                    <% } %>
                                    <div class="row">
                                    <div class="col s12">
                                    <b> Motivo Consulta</b>
                                    </div>
                                    <div class="col  s12">
                                        <textarea id="motiveConsulta" class="materialize-textarea" data-length="350" readonly><%= reception.motiveConsulta %></textarea>
                                        <label for="motiveConsulta"></label>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col s12">
                                    <b> Anotaciones relevantes para el abordaje del caso: 
                                      (A quién se ha consultado, eventos relacionados con la situación de la consulta, ha recibido anteriormente atención en el SAP)</b>
                                    </div>
                                    <div class="col  s12">
                                        <textarea id="anotacion_caso" class="materialize-textarea" data-length="350" readonly><%= reception.anotacion1 %></textarea>
                                        <label for="anotacion_caso"></label>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col s12">
                                    <b> Comprensión clínica del entrevistador: 
                                      (De la demanda, del motivo de la consulta y del contexto relacional)</b>
                                    </div>
                                    <div class="col  s12">
                                        <textarea id="comprension_entrevistador" class="materialize-textarea" data-length="350" readonly><%= reception.anotacion2 %></textarea>
                                        <label for="comprension_entrevistador"></label>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col s12">
                                    <b> Acuerdos establecidos para el primer encuentro de intervención: 
                                      (sistemas convocados y consideraciones en relación con ello) y sobre el procedimiento de remisión.</b>
                                    </div>
                                    <div class="col  s12">
                                        <textarea id="acuerdo_intervencion" class="materialize-textarea" data-length="350" readonly><%= reception.anotacion3 %></textarea>
                                        <label for="acuerdo_intervencion"></label>
                                    </div>
                                  </div>
                                  <div class="row">
                                    <div class="col s12">
                                    <b> Observaciones.
                                      (entre otros, confirmar fecha y hora para primer encuentro, recordar documentos solicitados para entregar en el primer encuentro, 
                                      recibió y tiene conocimiento del consentimiento y/o asentimiento informado)<b>
                                    </div>
                                    <div class="col s12">
                                        <textarea id="observacion" class="materialize-textarea" data-length="350" readonly><%= reception.observacion %></textarea>
                                        <label for="observacion"></label>
                                    </div>
                                  </div>

    
                                  </div>
                                </div>
                              </td>
                            </tr>
                            <% } %>
                          </tbody>
                        </table>
                      </div><br>
                      <div class="row">
                        <div class="col m12 m12 s12 text-center">
                          <!-- Modal Trigger -->
                          <a class="waves-effect waves-light btn modal-trigger col m12 m12 s12 green waves-light" href="#modal1">
                            <i class="material-icons">save</i>
                            <span style="position: relative; bottom: 4px;"> 
                              RECEPCIÓN DE PACIENTE
                          </a>
                        </div>
                      </div><br>
                      <% if(casoFallido.length > 0) { %>
                      <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize; text-align: center;"> Caso Fallido</h4>
                      <table id="tabla_caso" class="bordered highlight responsive-table centered">
                        <thead class="">
                          <tr>
                            <th>Profesional</th>
                            <th>Fecha</th>
                            <th><i class="material-icons">settings</i></th>
                          </tr>
                        </thead>
                        <tbody style="display: contents;">
                          <% for (let c = 0; c < casoFallido.length; c++) {
                            const caso = casoFallido[c]; 
                            const profe = casoFallido[c].Profesional; %>
                            <tr>
                              <td><%= profe.nombre %> <%= profe.apellido %></td>
                              <td><%= moment(caso.fechaSystem).locale('es').format('LLL') %></td>
                              <td><a href="/casoFallido/imprimir?id=<%= caso._id %>" target="_blank">Ver Caso Fallido<a></td>
                            </tr>
                          <% } %>
                        </tbody>
                      </table>
                     <% } %>
                </div>
                <% } %>
              <% } %>
              <input id="sedesRecepcion" type="hidden" value="<%= paciente.Sedes[0]._id %>" />
          
            
            <div id="test2">
              <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;">
              <div class="col s12">
                <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize; text-align: center;">cargue de documento</h4>
              <div class="row" class="col s12">
                <div class="col s12 m4 l2"></div>
                <div class="col s12 m4 l8"></div>
                <div class="col s12 m4 l2"><br>
                  <a id="addTable" class="waves-effect btn-flat col m12 s12 btn waves-effect primary waves-light">
                    <i class="material-icons">add_circle</i>
                    <span style="position: relative; bottom: 4px;"> Agregar Documento</span>
                  </a>
                </div>
                <table class="bordered highlight responsive-table centered">
                  <thead class="">
                    <tr>
                      <th>Tipo Documento</th>
                      <th>Descripcion</th>
                      <th>Seleccionar Archivo</th>
                      <th>Cargar/Descargar</th>
                    </tr>
                  </thead>
                  <tbody id="table_documentPacient">
                  </tbody>
                </table>
              </div>
             </div>
            </div>

          <div id="test3">
            <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;">

            <div class="">
              <div class="row">
                <h4 style="text-align: center; font-family: 'Times New Roman', Times, serif; text-transform: capitalize; text-align: center;"> Historial De Atenciones</h4>
                <div class="col s12 m4 l2"></div>
                <div class="col s12 m4 l8"></div>
                <div class="col s12 m4 l2"><br>
                  <a id="downloadHistory" class="waves-effect btn-flat col m12 s12 btn waves-effect primary waves-light">
                    <i class="material-icons">assignment</i>
                    <span style="position: relative; bottom: 4px;"> Ver Historia</span>
                  </a>
                </div>
                <table id="tabla_historias" class="bordered highlight responsive-table centered">
                  <thead class="">
                    <tr>
                      <th>Descargar Todo el Registro</th>
                      <th>Profesional</th>
                      <th>Fecha de la Cita</th>
                      <th>Servicio</th>
                      <th>Historia Clinica</th>
                      <th><i class="material-icons">settings</i></th>
                    </tr>
                  </thead>
                  <tbody style="display: contents;">
                    <% for (let h = 0; h < historias.length; h++) {
                      const historia = historias[h]; 
                      const servicio = historias[h].Cita.Servicio
                      const Sedes = historias[h].Cita.Sede 
                      const cita = historias[h].Cita %>
                      <tr>
                        <% if(historia.cerrado == true) { %>
                        <td style="width: 10%;margin-left: 7%;">
                          <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="<%= historia.Cita._id %>">
                            <label class="form-check-label" for="<%= historia.Cita._id %>"></label>
                          </div>
                        </td>
                        <% } else { %>
                          <td style="width: 10%;margin-left: 7%;">
                          </td>
                        <% }%>
                        <td><%= historia.Profesional.nombre %> <%= historia.Profesional.apellido %></td>
                        <td><%= moment(historia.Cita.start).locale('es').format('LLL') %></td>
                        <td><%= servicio != null ? servicio.nombre : 'Servicio Eliminado' %></td>
                        <td><i class="material-icons"><%- historia.cerrado ? 'lock' : 'lock_open' %></i></td>
                        <% if(Sedes._id == "60049afed00d9b43a49e4da7") { 
                          if(servicio.nombre == 'prueba 1'){
                            if(cita.closePrimeraVez == true){ %>
                              <td> <a href="/citas/atender?cita=<%= historia.Cita._id %>"><i
                                class="material-icons">assignment</i> Ver Historia</a> </td>
                                <% }else{ %>
                              <td> <a href="/citas/formularioPrimeraVez?cita=<%= historia.Cita._id %>"><i
                                class="material-icons">assignment</i> Ver Historia</a> </td>
                                <% } 
                          }else{
                            if(cita.closePrimeraVez == true){ %>
                              <td> <a href="/citas/atender?cita=<%= historia.Cita._id %>"><i
                                class="material-icons">assignment</i> Ver Historia</a> </td>
                                <% }else{ %>
                              <td> <a href="/citas/sessionU?cita=<%= historia.Cita._id %>"><i
                                class="material-icons">assignment</i> Ver Historia</a> </td>
                                <% } 
                          } %>
                        <%} else { %>
                        <td> <a href="/citas/atender?cita=<%= historia.Cita._id %>"><i
                              class="material-icons">assignment</i> Ver Historia</a> </td>
                        <% } %>
                      </tr>
                    <% } %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div id="test6">
            <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;">
            <div class="row">
              <div class="col s12">
                  <ul class="collapsible">
                    <li>
                      <div class="collapsible-header active"><i class="material-icons">folder_shared</i>
                        Remisión
                      </div>
                      <div class="collapsible-body">
                        <div class="row">
                          <div class="col s12 m4 l2"></div>
                          <div class="col s12 m4 l8"></div>
                          <div class="col s12 m4 l2">
                          </div>
                          <table id="tabla_remision" class="bordered highlight responsive-table centered">
                            <thead class="">
                              <tr>
                                <th>Profesional</th>
                                <th>Fecha de la Cita</th>
                                <th><i class="material-icons">settings</i></th>
                              </tr>
                            </thead>
                            <tbody style="display: contents;">
                              <% for (let h = 0; h < remision.length; h++) { 
                                const remisiones = remision[h];
                                const Profesional = remision[h].Profesional;%>
                                <tr>
                                  <td><%= Profesional.nombre %> <%= Profesional.apellido %></td>
                                  <td><%= moment(remisiones.fechaRemision).locale('es').format('LLL') %></td>
                                  <td> <a href="/remision/ver?remision=<%=remisiones._id %>" target="_blank"><i
                                        class="material-icons">print</i> Imprimir </a> </td>
                                </tr>
                              <% } %>
                            </tbody> 
                          </table>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="collapsible-header active"><i class="material-icons">check_circle</i>
                        Certificado
                      </div>
                      <div class="collapsible-body">
                        <div class="row">
                          <div class="col s12 m4 l2"></div>
                          <div class="col s12 m4 l8"></div>
                          <div class="col s12 m4 l2">
                          </div>
                          <table id="tabla_historias" class="bordered highlight responsive-table centered">
                            <thead class="">
                              <tr>
                                <th>Profesional</th>
                                <th>Fecha de la Cita</th>
                                <th>Servicio</th>
                                <th>Estado</th>
                                <th><i class="material-icons">settings</i></th>
                              </tr>
                            </thead>
                            <tbody style="display: contents;">
                              <% for (let h = 0; h < historias.length; h++) {
                                const historia = historias[h]; 
                                const servicio = historias[h].Cita.Servicio %>
                                <tr>
                                  <td><%= historia.Profesional.nombre %> <%= historia.Profesional.apellido %></td>
                                  <td><%= moment(historia.Cita.start).locale('es').format('LLL') %></td>
                                  <td><%= servicio != null ? servicio.nombre : 'Servicio Eliminado' %></td>
                                  <td><i class="material-icons"><%- historia.cerrado ? 'lock' : 'lock_open' %></i></td>
                                  <td> <a href="/certificado/ver?cita=<%= historia.Cita._id %>" target="_blank"><i
                                        class="material-icons">print</i> Imprimir </a> </td>
                                </tr>
                              <% } %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </li>
                      <li>
                        <div class="collapsible-header"><i class="material-icons">lock</i>Cierre</div>
                        <div class="collapsible-body"><span>
                        <div class="row">
                          <div class="col s12 m4 l2"></div>
                          <div class="col s12 m4 l8"></div>
                          <table  class="bordered highlight responsive-table centered">
                            <thead class="">
                              <tr>
                                <th>Fecha</th>
                                <th>Profesional</th>
                               <th><i class="material-icons">settings</i></th>      
                              </tr>
                            </thead>
                            <tbody style="display: contents;" id="tabla_cierre">                  
                            </tbody>
                          </table>
                        </div>
                      </span></div>
                    </li>
                      <!-- <hr class="separator separator--dotter" style="padding: 4px; background-color:#00bcd4;"><br><br> -->
                      <li> 
                          <div class="collapsible-header"><i class="material-icons">assignment</i>Resumen de historia clinica</div>
                          <div class="collapsible-body"><span>
                            <div class="row">
                            <div class="col s12 m4 l2"></div>
                            <div class="col s12 m4 l8"></div>
                            <table  class="bordered highlight responsive-table centered">
                              <thead class="">
                                <tr>
                                  <th>Fecha</th>
                                  <th>Profesional</th>
                                  <th><i class="material-icons">settings</i></th>
                                </tr>
                              </thead>
                              <tbody style="display: contents;" id="tabla_resumeHc">                      
                              </tbody>
                            </table>
                          </div>
                        </span>
                      </div>
                      </li>
                      <li>                
                      <div class="collapsible-header"><i class="material-icons">poll</i>Imforme de remisión</div>
                      <div class="collapsible-body"><span>
                        <div class="row">
                          <div class="col s12 m4 l2"></div>
                          <div class="col s12 m4 l8"></div>
                          <table  class="bordered highlight responsive-table centered">
                            <thead class="">
                              <tr>
                                <th>Fecha</th>
                                <th>Profesional</th>
                                <th><i class="material-icons">settings</i></th>    
                             </tr>
                            </thead>
                            <tbody style="display: contents;" id="tabla_informes">                   
                            </tbody>
                          </table>
                        </div>
                      </span>
                    </div>
                  </li>
                  <!-- <li>
                    <div class="collapsible-header"><i class="material-icons">folder_shared</i>Seguimiento</div>
                      <div class="collapsible-body"><span>
                      <div class="row">
                        <div class="col s12 m4 l2"></div>
                        <div class="col s12 m4 l8"></div>
                        <table  class="bordered highlight responsive-table centered">
                          <thead class="">
                            <tr>
                              <th>Fecha</th>
                              <th>Profesional</th>
                              <th><i class="material-icons">settings</i></th>
      
                            </tr>
                          </thead>
                          <tbody style="display: contents;" id="tabla_seguimiento">
                           
                          </tbody>
                        </table>
                      </div>
                  </li> -->
                </ul><br>
                <div class="row" style="text-align: center;">
                  <div class="col s4">
                    <a class="waves-effect waves-light btn modal-trigger green waves-light" href="#modalCierre">
                      <i class="material-icons">lock</i>
                      <span style="position: relative; bottom: 4px;"> 
                        Crear un cierre
                    </a>
                  </div>
                  <div class="col s4">
                    <a class="waves-effect waves-light btn modal-trigger green waves-light" href="#modalResumenHC">
                      <i class="material-icons">assignment</i>
                      <span style="position: relative; bottom: 4px;"> 
                        Crear un resumen HC
                    </a>
                  </div>
                  <div class="col s4">
                    <a class="waves-effect waves-light btn modal-trigger green waves-light" href="#modalInformeRemision">
                      <i class="material-icons">poll</i>
                      <span style="position: relative; bottom: 4px;"> 
                        Crear un informe remisión
                    </a>
                  </div>
                  <!-- <div class="col s3">
                    <a class="waves-effect waves-light btn modal-trigger green waves-light" href="#modalSeguimiento">
                      <i class="material-icons">folder_shared</i>
                      <span style="position: relative; bottom: 4px;"> Seguimiento
                    </a>
                  </div> -->
                </div>
              </div>
            </div>
          </div>
        </ul>
      </div>
    </div>
  </div>

</section>


  </div>

  <!-- Modal Structure -->
  <div id="modal1" class="modal" style="width: 90%;">
    <div class="modal-content">
      <div class="modal-header">
        <div class="row">
          <form class="col s12">
            <div class="row">
              <div class="col s6">
              </div>
              <div class="col s6">                
                <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat" style="margin-left: 89%;">
                  <i class="material-icons">close</i>
                  <span style="position: relative; bottom: 4px;"> </span>
                </a>
              </div>
            </div>
          </form>
        </div>
      </div>
      <input id="sedesRecepcionModal" type="hidden" value="<%= paciente.Sedes[0]._id %>" />
      <div class="row">
        <div class="row">
            <div class="row">
              <div class="col s12 m6 offset-m3 center">
                <h5>
                  <b>RECEPCIÓN</b>
                </h5>
              </div>
            </div>            
            <div class="row">
              <div class="col s2">
                Fecha
              </div>
              <div class="col s6" style="margin-left: 11%;" id="fechSystem">
                <%-
                  new Date()
                %>
              </div>
            </div>
            <div class="row">
              <div class="col s6">
                <b>Psicólogo en Formación /Psicólogo Clínico y de la Familia en Formación: </b>
              </div>
              <div class="col s6" id="psoclogyFormated">
                <%= user.nombre %> <%= user.apellido %>
              </div>
            </div>
            <div class="row">
              <div class="col s12 m6 ">
                Clasificación relacionado con el motivo de consulta.
              </div>
            </div>
            <div class="row">
              <div class="col s8">
                Nivel:
              </div>
            </div>
            <div class="row">
              <div class="col s1">
                Caso Remitido:
              </div>
              <div class="col s3">
                  <select id="remision" class="validate select browse-select">
                      <option value="" disabled selected>Elige una opción</option>
                      <option value="SI">SI</option>
                      <option value="NO">NO</option>
                  </select>
                  <label for="remision">Remisión</label>
              </div>
            </div>
            <div id="dropdownInstitucion" class="row">
             <div class="col s2" style="text-align: left;">Tipo de Institución: </div> 
              <div class="row">
                <div class="col s3 ">
                  <select id="tipIntitucion" class="validate select browse-select">
                      <option value="" disabled selected>Elige una opción</option>
                      <option value="IAB">Instituciones Académicas Básica</option>
                      <option value="IG">Instituciones Gubernamentales</option>
                      <option value="IAS">Instituciones Académicas Superiores</option>
                      <option value="OI">Otras Instituciones</option>
                  </select>
                  <label for="tipIntitucion"></label>
                </div>

                <div id="IAB" class="institucion s4" style="display:none">
                  <div class="col s2" style="text-align: left;" > Institución Remisora:</div>    
                  <div class="col s3 ">      
                  <select id="IAB_tipIntitucion" class="validate select browse-select">
                    <option value="" disabled selected>Elige una opción</option>
                    <option value="IAB_CPP">Colegios Publicos (IED)</option>
                    <option value="IAB_CP">Colegios Privados</option>
                    <option value="IAB_JP">Jardines Privados</option>
                  </select>
                  <label for="IAB_tipIntitucion"></label>
                  </div>
                </div>
                <div id="IG" class="institucion  s4" style="display:none">
                  <div class="col  s2" style="text-align: left;"> Institución Remisora:</div> 
                  <div class="col s3">
                  <select id="IG_tipIntitucion" class="validate select browse-select">
                    <option value="" disabled selected>Elige una opción</option>
                    <option value="IG_CF">Comisarías de Familia</option>
                    <option value="IG_CZ">Centros Zonales del ICBF</option>
                    <option value="IG_JF">Juzgados de Familia</option>
                    <option value="IG_FGN">Fiscalía General de la Nación</option>
                    <option value="IG_O">Otros</option>
                  </select>
                  <label for="IG_tipIntitucion"></label>
                  </div>
                </div>
                <div id="IAS" class="institucion  s4" style="display:none">
                  <div class="col  s2" style="text-align: left;"> Institución Remisora:</div> 
                  <div class="col s3">
                  <select id="IAS_tipIntitucion" class="validate select browse-select">
                    <option value="" disabled selected>Elige una opción</option>
                    <option value="IAS_TEC">Técnicos</option>
                    <option value="IAS_TECG">Tecnológicos</option>
                    <option value="IAS_JF">Universitarios Públicos</option>
                    <option value="IAS_FGN">Universitarios Privados</option>
                  </select>
                  <label for="IAS_tipIntitucion"></label>
                  </div>
                </div>
                <div id="OI" class="institucion  s4" style="display:none">
                  <div class="col  s2" style="text-align: left;"> Institución Remisora:</div> 
                  <div class=" col s3">
                  <select id="OI_tipIntitucion" class="validate select browse-select">
                    <option value="" disabled selected>Elige una opción</option>
                    <option value="OI_FUND">Fundaciones</option>
                    <option value="OI_ONG">ONG</option>
                    <option value="OI_EPP">Empresas Públicas</option>
                    <option value="OI_EPR">Empresas Privadas</option>
                  </select>
                  <label for="OI_tipIntitucion"></label>
                  </div>
                </div>
              </div>
              
              <div class="col s4">
                Nombre de la Institución:
              </div>
              <div class="col  m10 s7">
                  <textarea id="nameInstitution" class="materialize-textarea" data-length="120"></textarea>
                  <label for="nameInstitution"></label>
              </div>
              <div class="col s4">
                Nombre de profesional que remite:
              </div>
              <div class="col m10 s7 ">
                  <textarea id="nameInstitutionRemite" class="materialize-textarea" data-length="120"></textarea>
                  <label for="nameInstitutionRemite"></label>
              </div>
              <div class="col s4">
                Motivo de remisión:
              </div>
              <div class="col m10 s7 ">
                  <textarea id="motiveRemision" class="materialize-textarea" data-length="120"></textarea>
                  <label for="motiveRemision"></label>
              </div>
            </div>
            <div class="row">
              <div class="col s4">
                Motivo Consulta
              </div>
              <div class="col m10 s10">
                  <textarea id="motiveConsulta" class="materialize-textarea" data-length="350"></textarea>
                  <label for="motiveConsulta"></label>
              </div>
            </div>
            <div class="row">
              <div class="col s10">
                Anotaciones relevantes para el abordaje del caso: 
                (A quién se ha consultado, eventos relacionados con la situación de la consulta, ha recibido anteriormente atención en el SAP)
              </div>
              <div class="col m10 s10">
                  <textarea id="anotacion_caso" class="materialize-textarea" data-length="350"></textarea>
                  <label for="anotacion_caso"></label>
              </div>
            </div>
            <div class="row">
              <div class="col s10">
                Comprensión clínica del entrevistador: 
                (De la demanda, del motivo de la consulta y del contexto relacional)
              </div>
              <div class="col m10 s10">
                  <textarea id="comprension_entrevistador" class="materialize-textarea" data-length="350"></textarea>
                  <label for="comprension_entrevistador"></label>
              </div>
            </div>
            <div class="row">
              <div class="col s10">
                Acuerdos establecidos para el primer encuentro de intervención: 
                (sistemas convocados y consideraciones en relación con ello) y sobre el procedimiento de remisión.
              </div>
              <div class="col m10 s10">
                  <textarea id="acuerdo_intervencion" class="materialize-textarea" data-length="350"></textarea>
                  <label for="acuerdo_intervencion"></label>
              </div>
            </div>
            <div class="row">
              <div class="col s10">
                Observaciones.
                (entre otros, confirmar fecha y hora para primer encuentro, recordar documentos solicitados para entregar en el primer encuentro, 
                recibió y tiene conocimiento del consentimiento y/o asentimiento informado)
              </div>
              <div class="col m10 s10">
                  <textarea id="observacion" class="materialize-textarea" data-length="350"></textarea>
                  <label for="observacion"></label>
              </div>
            </div>
            <div class="row" style="display:none">
              <div class="col s4">
                  Practicante asignado
              </div>
              <div class="col m2 s4">
                  <select id="tpAsignado" class="validate select browse-select">
                      <option value="" disabled selected>Elige una opción</option>
                  </select>
                  <label for="tpAsignado"></label>
              </div>
              <div class="col s4" style="display:none">
                Docente Supervisor asignado
              </div>
              <div class="col m2 s4" style="display:none">
                  <select id="dc_Asignado" class="validate select browse-select">
                      <option value="" disabled selected>Elige una opción</option>
                  </select>
                  <label for="dc_Asignado"></label>
              </div>
            </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <div class="row">
        <form class="col s12">
          <div class="row">
            <div class="col s6">
            </div>
            <div class="col s6">
              <button class="waves-effect btn-flat col m12 m12 s12 btn waves-effect green waves-light" id="recepcionData">
                <i class="material-icons">save</i>
                <span style="position: relative; bottom: 4px;"> Guardar</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal" id="modalInformeRemision">
    <div class="modal-content">
      <div class="modal-header"></div>
      <div class="modal-content">
          <div class="row" style="background-color: #D9D9D9;">
            <center>
              <p><strong>INFORME DE RESPUESTA A REMISIÓN   </strong></p>
            </center>
          </div>
          <div class="row">
            <div class="col s6">
              Fecha de registro:  <%=moment(new Date()).locale('es').format('LLL')  %>
            </div>
          </div>
          <div class="row">
            <div class="col s6">
              Informe de remisión: 
            </div><br>
            <div class="col s12">              
              <textarea type="text" name="idInformeremision" id="idInformeremision" type="text" 
              class="materialize-textarea clean_on_create tooltipped" data-position="top" data-delay="50" data-length="5000" style="width: 100%;"
                data-tooltip="Observaciones y apreciaciones del supervisor." style ="resize: horizontal;"></textarea>
            </div>
          </div>
          <div class="row">
            <div class="col s6">
              Entidad que remite:
            </div><br>
            <div  class="input-field col s12">
              <textarea type="text" name="entidadRemite" id="entidadRemite" type="text" 
              class="materialize-textarea clean_on_create tooltipped" data-position="top" data-delay="50" data-length="5000" style="width: 100%;"
                data-tooltip="Observaciones y apreciaciones del supervisor." style ="resize: horizontal;"></textarea>
          </div>
          </div>
          <div class="row">
            <div class="col s6">
              Profesional que remite: 
            </div><br>
            <div  class="input-field col s12">
              <textarea type="text" name="psicologoRemite" id="psicologoRemite" type="text" 
              class="materialize-textarea clean_on_create tooltipped" data-position="top" data-delay="50" data-length="5000" style="width: 100%;"
                data-tooltip="Observaciones y apreciaciones del supervisor." style ="resize: horizontal;"></textarea>
          </div>
          </div>
          <div class="row">
            <div class="col s6">
              Motivo de remisión: 
            </div>
                <div  class="input-field col s12">
                  <textarea  id="motivoRemision" type="text" value="" class="materialize-textarea clean_on_create tooltipped" data-tooltip="Observaciones y apreciaciones del supervisor."></textarea>
              </div>
          </div>
          <div class="row">
            <div class="col s6">
              Intervención realizada:
            </div><br>
            <div class="col s12">              
              <textarea type="text" name="idIntervencion" id="idIntervencion" type="text" 
              class="materialize-textarea clean_on_create tooltipped" data-position="top" data-delay="50"
                data-tooltip="Observaciones y apreciaciones del supervisor."></textarea>
            </div>
          </div>
          <div class="row">
            <div class="col s6">
              Resultados y acuerdos realizados:
            </div><br>
            <div class="col s12">              
              <textarea type="text" name="idResultadosRealizados" id="idResultadosRealizados" type="text" 
              class="materialize-textarea clean_on_create tooltipped" data-position="top" data-delay="50"
                data-tooltip="Observaciones y apreciaciones del supervisor."></textarea>
            </div>
          </div>
          <div class="row">
            <div class="col s6">
              Recomendaciones para la entidad que remite y para el paciente:
            </div><br>
            <div class="col s12">              
              <textarea type="text" name="idRecomendacionesProfesionales" id="idRecomendacionesProfesionales" type="text" 
              class="materialize-textarea clean_on_create tooltipped"data-position="top" data-delay="50"
                data-tooltip="Observaciones y apreciaciones del supervisor."></textarea>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">        
        <div class="row">
          <form class="col s12">
            <div class="row">
              <div class="col s6">
              </div>
              <div class="col s6">
                <button class="waves-effect btn-flat col m12 m12 s12 btn waves-effect green waves-light" id="informeREmision">
                  <i class="material-icons">save</i>
                  <span style="position: relative; bottom: 4px;"> Guardar</span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalCierre">
    <div class="modal-content">
      <div class="modal-header"></div>
      <div class="modal-content">
        <div class="row" style="background-color: #D9D9D9;">
          <center>
            <p><strong> CIERRE </strong></p>
          </center>
        </div>

        <div class="row">
          <div class="col s6">
            N° de sesiones programadas:
          </div>
          <div class="col s2">
            <input type="text" id="numeroDeSesionesCierre" value="<%= historias.length %>" readonly>
          </div>
        </div>
        <div class="row">
          <div class="col s6">
            Objetivos cumplidos en el plan terapéutico
          </div>
          <div class="col s12">
            <textarea type="text" name="idLogosAlcanzados" id="idLogosAlcanzados" type="text" 
            class="materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
            data-tooltip="Objetivos cumplidos en el plan terapéutico" ></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            Percepción de cambio de paciente o consultante 
          </div>
          <div class="col s12">
            <textarea type="text" name="idDescripcionEmergentes" id="idDescripcionEmergentes" type="text" 
            class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
            data-tooltip="Percepción de cambio de paciente o consultante "></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col s6">
            Motivo de Cierre:  
          </div>
          <div class="col s12">
            <textarea type="text" name="motivoCierre" id="motivoCierre" type="text" 
            class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
            data-tooltip="Motivo de cierre"></textarea>
          </div>
        </div>
        <div>
          <div class="form-check">
            <input   type="checkbox" class="form-check-input" id="aprobarCierre">
            <label class="form-check-label" for="aprobarCierre">Descarga con con codigo cie10</label>
        </div>
        </div>
      </div>
      <div class="modal-footer">        
        <div class="row">
          <form class="col s12">
            <div class="row">
              <div class="col s6">
              </div>
              <div class="col s6">
                <button class="waves-effect btn-flat col m12 m12 s12 btn waves-effect green waves-light" id="btnCierre">
                  <i class="material-icons">save</i>
                  <span style="position: relative; bottom: 4px;"> Guardar</span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      </div>
    </div>
  </div>
<% if( historias.length > 0 ){ %>
  <div class="modal" id="modalResumenHC">
    <div class="modal-content">
      <div class="modal-header">
        <div class="col s12">
          <center>
            <p><strong>RESUMEN DE HISTORIA CLINICA </strong></p>
          </center>
        </div><br>        
          <div class="row">
             <div class="col s4" ><b>Fecha Inicio</b><input type="text" value="<%= moment(historias[0].Cita.start).locale('es').format('LLL') %>" id="fechaInicio" readonly></div>
             <div class="col s4"><b>Número de sesiones:</b> <input type="text" value="<%= historias.length %> " id="numeroDeSesiones" readonly></div>
             <div class="col s4" > <b>Fecha Fin:</b><input type="text" value="<%= moment(historias[historias.length - 1].Cita.start).locale('es').format('LLL') %> " id="fechaFin" readonly></div>
          </div><br>
          <div class="row">
            <div class="col s12">
            <b>Psicólogo en Formación /Psicólogo Clínico y de la Familia en Formación: </b>
            </div>
            <div class="col s6" id="psoclogyFormated">
              <%= user.nombre %> <%= user.apellido %>
            </div>
          </div><br>
        <div class="row">
          <div class="col s6 m6">
          <b>  Motivo de consulta </b>
          </div>
          <div class="col s12">  
            <textarea id="motivoConsulta1" class="materialize-textarea" data-length="120"></textarea>
            <label for="motivoConsulta1"></label>
           </div>
           <div class="col s6 m6">
          <b>Generalidad de la intervención</b>
          </div>
          <div class="col s12">  
            <textarea id="lecturaPsicologica1" class="materialize-textarea" data-length="120"></textarea>
            <label for="lecturaPsicologica1"></label>
           </div>
           <div class="col s6 m6">
          <b>Objetivos de la intervención </b>
          </div>
          <div class="col s12">  
            <textarea id="objetivoIntervecion1" class="materialize-textarea" data-length="120"></textarea>
            <label for="objetivoIntervecion1"></label>
           </div>

        </div>
        <div class="row">
          <div class="col s6 m6">
            <b>Logros alcanzados en el proceso terapéutico</b>
          </div>
            <div class="col s12">  
              <textarea id="logrosAlcanzados1" class="materialize-textarea" data-length="120"></textarea>
              <label for="logrosAlcanzados1"></label>
            </div>
            <div class="col s6 m6">
              <b> Motivo de cierre  </b>
            </div>
            <div class="col s12">
              <textarea id="motivoCierre1" class="materialize-textarea" data-length="120"></textarea>
              <label for="motivoCierre1"></label>
            </div>
            <div class="col s6 m6">
                <b> Recomendaciones    </b>
            </div>
            <div class="col s12">  
                  <textarea id="Recomendaciones1" class="materialize-textarea" data-length="120"></textarea>
                  <label for="Recomendaciones1"></label>
            </div>
          </div>

      </div>
      <div class="modal-footer">        
        <div class="row">
          <form class="col s12">
            <div class="row">
              <div class="col s6">
              </div>
              <div class="col s6">
                <button class="waves-effect btn-flat col m12 m12 s12 btn waves-effect green waves-light" id="resumenHC">
                  <i class="material-icons">save</i>
                  <span style="position: relative; bottom: 4px;"> Guardar</span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      </div>
    </div>
    <% } %>
  </div>
  
  <div class="modal" id="modalSeguimiento">
    <div class="modal-content">
      <div class="modal-header"></div>
      <div class="modal-content">
        <div class="row">
          <center>
            <p><strong>SEGUIMIENTO </strong></p>
          </center>
        </div>
        <div class="row">
          <div class="col s6">
            Fecha: <%= new Date(); %>
          </div>
        </div>
        <div class="row">
          <div class="col s6">Tipo de contacto:     </div>
          <div class="col s6">
            <select name="typecontrato" id="typecontrato">
              <option value="" disabled selected>Eligue una opcion</option>
              <option value="Telefónico" >Telefónico</option>
              <option value="Presencial" >Presencial</option>
              <option value="Videollamada" >Videollamada</option>
            </select>
          </div>
          <div class="col s6">¿Desea continuar con el proceso?: </div>
          <div class="col s6">
            <select name="continuarProceso" id="continuarProceso">
              <option value="" disabled selected>Eligue una opcion</option>
              <option value="SI" >SI</option>
              <option value="NO" >NO</option>
            </select></div>
        </div>
        <div class="row">
          <div class="col s6">Percepción de la situación actual:</div>
          <div class="col s12">
            <textarea type="text" name="percepcion" id="percepcion" type="text" 
            class="materialize-textarea" data-length="120" data-position="top" 
            data-tooltip="Logros alcanzados según el consultante."></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col s12">Cambios identificados por el sistema consultante y reporte de recursos y aprendizajes:</div>
          <div class="col s12">
            <textarea type="text" name="cambiosIdentificados" id="cambiosIdentificados" type="text" 
             class="materialize-textarea" data-position="top" data-delay="50"
            data-tooltip="Logros alcanzados según el consultante."></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col s6">Proyectos futuros:</div>
          <div class="col s12">
            <textarea type="text" name="proyectosFuturos" id="proyectosFuturos" type="text" 
             class="materialize-textarea" data-position="top" data-delay="50"
            data-tooltip="Logros alcanzados según el consultante."></textarea>
          </div>
        </div>
        <div class="row">
          <div class="col s6">Observaciones y apreciaciones del psicólogo:</div>
          <div class="col s12">
            <textarea type="text" name="observacionesPsicologo" id="observacionesPsicologo" type="text" 
             class="materialize-textarea" data-position="top" data-delay="50"
            data-tooltip="Logros alcanzados según el consultante."></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">        
        <div class="row">
          <form class="col s12">
            <div class="row">
              <div class="col s6">
              </div>
              <div class="col s6">
                <button class="waves-effect btn-flat col m12 m12 s12 btn waves-effect green waves-light" id="btnseguimiento">
                  <i class="material-icons">save</i>
                  <span style="position: relative; bottom: 4px;"> Guardar</span>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      </div>
    </div>
  </div>
  <div class="modal" id="ModalFirma">
    <div class="modal-content">
        <div class="row">
            <div class="file-field input-field  col l6 s12">
                <div class="btn blue">
                    <span>Firma Practicante</span> 
                </div>
                <div class="file-path-wrapper">
                </div>
            </div>
            <div class="file-field input-field  col l6 s12">
                <div class="btn red">
                    <span>Firma Supervisor</span>
                </div>
                <div class="file-path-wrapper">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col l6 s6" id="profeFirma">

            </div>
            <div class="col l6 s6" id="superFirma">

            </div>
        </div>   
    </div>
 </div> 
  <div class="modal" id="ModalInformes">
    <div class="modal-content">
      <section>
        <div id="content_timeline_iforme">

            
        </div>
    </section>
      <br >
      <input type="hidden" disabled name="" id="IdInforme">
      <section>
          <div class="row">
            <textarea id="value_informe" class="materialize-textarea clean_on_create tooltipped" tipo="parrafo"
                data-length="5000" data-position="top" data-delay="50" data-tooltip="Comentario Informes."  style="width: 100%;"></textarea>
          </div>
          <div class="row">
              <button type="button" id="btnGuardarComment_informes" class="waves-effect waves-light btn green waves-light"> Guardar Observación </button>
              <% if(user.roles == "SP"){ %>
                <button type="button" class="waves-effect waves-light btn blue waves-light aprobarInfo " > Guardar Aprobación </button>
              <% } %>
          </div>
      </section>
    </div>
</div> 
<div class="modal" id="ModalResumen">
  <div class="modal-content">
    <section>
      <div id="content_timeline_resumen">

          
      </div>
  </section>
    <br >
    <input type="hidden" disabled name="" id="IdResumen">
    <section>
        <div class="row">
          <textarea id="value_resumen" class="materialize-textarea clean_on_create tooltipped" tipo="parrafo"
              data-length="5000" data-position="top" data-delay="50" data-tooltip="Comentario Resumen."  style="width: 100%;"></textarea>
        </div>
        <div class="row">
            <button type="button" id="btnGuardarComment_resumen" class="waves-effect waves-light btn green waves-light"> Guardar Observación</button>
            <% if(user.roles == "SP"){ %>
              <button type="button" class="waves-effect waves-light btn blue waves-light aprobarResumen " > Guardar Aprobación </button>
            <% } %>
        </div>
    </section>
  </div>
</div> 
<div class="modal" id="ModalCierre">
  <div class="modal-content">
    <section>
      <div id="content_timeline_cierre">

          
      </div>
  </section>
    <br >
    <input type="hidden" disabled name="" id="IdCierre">
    <section>
        <div class="row">
          <textarea id="value_cierre" class="materialize-textarea clean_on_create tooltipped" tipo="parrafo"
              data-length="5000" data-position="top" data-delay="50" data-tooltip="Comentario Cierre."  style="width: 100%;"></textarea>
        </div>
        <div class="row">
            <button type="button" id="btnGuardarComment_cierre" class="waves-effect waves-light btn green waves-light"> Guardar Observación</button>
            <% if(user.roles == "SP"){ %>
              <button type="button" class="waves-effect waves-light btn blue waves-light aprobarCierre " > Guardar Aprobación </button>
            <% } %>
        </div>
    </section>
  </div>
</div> 

<% include  ../../view_distribution/sidebar-right.ejs%>
<% include  ../../view_distribution/bot1.ejs%>
<% include  ../../scripts/convertEJS.ejs%>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment-with-locales.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>


<script> 
  var locali=0;
  var depart=0;
  var munici=0;

  var EpsToAutoComplete = Object({})
  var Municipios = <%- JSON.stringify(municipios) %>;
  var Cantones = <%- JSON.stringify(canton) %>;
  var historia = <%- JSON.stringify(historias) %>;

  

//     var fechaIncioHc = historia[0].Cita.start
//   console.log(fechaIncioHc)
//   var options = { year: "numeric", month: "long", day: "numeric", hour: "numeric", hour12:"false", minute: "numeric"};
//               var fechaIncioHc = new Date(fechaIncioHc)
//               fechaIncioHc=  fechaIncioHc.toLocaleString ("es-ES", options)
//  $('#fechaInicio').val(fechaIncioHc)

  var input = document.querySelector("#phone");
    var input = document.querySelector("#phone");
    window.intlTelInput(input, {
    // allowDropdown: false,
    // autoHideDialCode: false,
    // autoPlaceholder: "off",
    // dropdownContainer: document.body,
    // excludeCountries: ["us"],
    // formatOnDisplay: false,
    // geoIpLookup: function(callback) {
    // $.get("http://ipinfo.io", function() {}, "jsonp").always(function(resp) {
    // var countryCode = (resp && resp.country) ? resp.country : "";
    // callback(countryCode);
    // });
    // },
    // hiddenInput: "full_number",
    // initialCountry: "auto",
    // localizedCountries: { 'de': 'Deutschland' },
    nationalMode: false,
    // onlyCountries: ['us', 'gb', 'ch', 'ca', 'do'],
    placeholderNumberType: "FIXED_LINE",
    preferredCountries: ['co'],
    separateDialCode: true,
    utilsScript: "https://cdnmetamedic.s3.amazonaws.com/js/intl-input/utils.js",

    });

    var input2 = document.querySelector("#cell");
    window.intlTelInput(input2, {
    // allowDropdown: false,
    // autoHideDialCode: false,
    // autoPlaceholder: "off",
    // dropdownContainer: document.body,
    // excludeCountries: ["us"],
    // formatOnDisplay: false,
    // geoIpLookup: function(callback) {
    // $.get("http://ipinfo.io", function() {}, "jsonp").always(function(resp) {
    // var countryCode = (resp && resp.country) ? resp.country : "";
    // callback(countryCode);
    // });
    // },
    // hiddenInput: "full_number",
    // initialCountry: "auto",
    // localizedCountries: { 'de': 'Deutschland' },
    nationalMode: false,
    // onlyCountries: ['us', 'gb', 'ch', 'ca', 'do'],
    placeholderNumberType: "MOBILE",
    preferredCountries: ['co'],
    separateDialCode: true,
    utilsScript: "https://cdnmetamedic.s3.amazonaws.com/js/intl-input/utils.js",

    });
   

    document.addEventListener('DOMContentLoaded', function() {
      $('#tipIntitucion').change(function() {
        $('.institucion').hide();
        $('#' + $(this).val()).show();
        
    });

      $('#remision').val("");
      var citas = $("#Create_Cita").val()
      

      if(citas == 'checked') {
        $('#checkboxF1').prop( "checked", true).trigger('click');
      }
      $("#escolaridad").select2()
         $('#escolaridad').material_select();
         $("#isex").select2()
         $('#isex').material_select();
         $("#ocupacion").select2()
         $('#ocupacion').material_select();
         $("#estado_civil").select2()
         $('#estado_civil').material_select();
         $("#genero").select2()
         $('#genero').material_select();
         $("#rh").select2()
         $('#rh').material_select();
         $("#regimen_salud").select2()
         $('#regimen_salud').material_select();
         $("#eps").select2()
         $('#eps').material_select();
         $("#pertenencia_etnica").select2()
         $('#pertenencia_etnica').material_select();
         $("#profeAsig").select2()
         
    });

    $('.datepicker').on('mousedown', function (event) {
        event.preventDefault();
    })

    $('.pickerdate').on('mousedown', function (event) {
        event.preventDefault();
    })
    
    $(document).on("click", ".select-wrapper", function (event) {
        event.stopPropagation();
    });
    

    
    $('.datepicker').pickadate({
        monthsFull: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto',
            'Septiembre',
            'Octubre', 'Noviembre', 'Diciembre'
        ],
        monthsShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov',
            'Dic'
        ],
        weekdaysFull: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
        weekdaysShort: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
        selectMonths: true,
        selectYears: 100, // Puedes cambiarlo para mostrar más o menos años
        min: new Date(1650, 1, 1),
        max: true, // `true` sets it to today. `false` removes any limits.
        today: 'Hoy',
        clear: 'Limpiar',
        close: 'Ok',
        labelMonthNext: 'Siguiente mes',
        labelMonthPrev: 'Mes anterior',
        labelMonthSelect: 'Selecciona un mes',
        labelYearSelect: 'Selecciona un año',
        container: undefined, // ex. 'body' will append picker to body

    });

    $('#tipIntitucion').change(function() {
        $('.institucion').hide();
        $('#' + $(this).val()).show();
    });
      $("#dropdownInstitucion").hide();
        $('#remision').on('change', function() {
        if ( this.value == 'SI')
        {
          $("#dropdownInstitucion").show();
        }
        else
        {
          $("#dropdownInstitucion").hide();
        }
        });
    $("#addTable").click(function() {
        console.log(">>>> Dato agregado")
        const tr = $("#table_documentPacient tr").length;
        let sedeData = $("#sedesRecepcion").val();
        if(sedeData == "60049afed00d9b43a49e4da7"){
          $("#table_documentPacient").append(`
                              <tr class='tabrow closed'>
                                  <td>
                                    <select id="tipDocumentAdd_${tr}" class="validate select browse-select">
                                      <option value="" disabled >Elige una opción</option>
                                        <option value="Fotocopia de cédula (de los integrantes)">Fotocopia de cédula (de los integrantes)</option>
                                        <option value="CONSENTIMIENTO INFORMADO">CONSENTIMIENTO INFORMADO</option>
                                        <option value="ASENTIMIENTO INFORMADO">ASENTIMIENTO INFORMADO</option>
                                        <option value="PRIMER RECIBO DE PAGO">PRIMER RECIBO DE PAGO</option>
                                        <option value="TARJETA IDENTIDAD PARA MAYOR DE 7 AÑOS"> TARJETA IDENTIDAD PARA MAYOR DE 7 AÑOS</option>
                                        <option value="REGISTRO CIVIL (Para todo menor de edad)">REGISTRO CIVIL (Para todo menor de edad)</option>
                                        <option value="DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO">DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO.</option>
                                        <option value="ACTA DE DEFUNCIÓN">ACTA DE DEFUNCIÓN</option>
                                        <option value="DOCUMENTO INCRUSTADO">DOCUMENTO INCRUSTADO (ESTABLECER LOS DOCUMENTOS A CARGAR DE MANERA COMPILADA EN UN SOLO ARCHIVO) </option>
                                    </select>
                                    <label for='tipDocumentAdd_${tr}'>tipo documento</label>
                                  </td> 
                                  <td>
                                    <input class="note" id="descripcionAdd_${tr}" type="text" class="validate">
                                    <label for="descripcionAdd_${tr}"></label>
                                  </td>
                                  <td>
                                    <input type="file" class="campo_imagen1" id="filedocument_${tr}"
                                            accept="image/*, application/pdf">
                                  </td>
                                  <td>
                                    <a id="saveData_${tr}" class="saveRow waves-effect btn-flat col m12 m12 s12 btn waves-effect red waves-light">
                                      <i class="material-icons">cloud_upload</i>
                                      <span style="position: relative; bottom: 4px;"> Cargar </span>
                                    </a>
                                  </td>
                              </tr>`)
        }else{
        $("#table_documentPacient").append(`
                              <tr class='tabrow closed'>
                                  <td>
                                    <select id="tipDocumentAdd_${tr}" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option value="FC">Fotocopia de cédula (de los integrantes)</option>
                                        <option value="CYA">CONSENTIMIENTO Y/O ASENTIMIENTO</option>
                                        <option value="RDP">RECIBO DE PAGO</option>
                                        <option value="HCE">HISTORIA CLINICA EXTERNA</option>
                                        <option value="RCT">REGISTRO CIVIL Y TARJETA PARA MENORES DE EDAD</option>
                                        <option value="DCC">DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO.</option>
                                        <option value="DIU">DOCUMENTO INCRUSTADO (ESTABLECER LOS DOCUMENTOS A CARGAR DE MANERA COMPILADA EN UN SOLO ARCHIVO) </option>
                                    </select>
                                    <label for='tipDocumentAdd_${tr}'>tipo documento</label>
                                  </td> 
                                  <td>
                                    <input class="note" id="descripcionAdd_${tr}" type="text" class="validate">
                                    <label for="descripcionAdd_${tr}"></label>
                                  </td>
                                  <td>
                                    <input type="file" class="campo_imagen1" id="filedocument_${tr}"
                                            accept="image/*, application/pdf">
                                  </td>
                                  <td>
                                    <a id="saveData_${tr}" class="saveRow waves-effect btn-flat col m12 m12 s12 btn waves-effect red waves-light">
                                      <i class="material-icons">cloud_upload</i>
                                      <span style="position: relative; bottom: 4px;"> Cargar </span>
                                    </a>
                                  </td>
                              </tr>`)
        }
        $(`#tipDocumentAdd_${tr}`).material_select();
      });
    
      let sedeData = $("#sedesRecepcion").val();
        let idUser = $("#user_id").val() || null;
       if(sedeData == "60049afed00d9b43a49e4da7"){
        var idProfesionalE = <%- JSON.stringify(paciente.idProfesional) || null %>
          $.ajax({
              method: 'GET',
              url: `/api/profesionales/getAllProfe/${sedeData}/${idProfesionalE}`,
              success: function (r){
              var firmaPro = r
              $("#profeFirma").html(`
              <img src="${firmaPro.foto_firma != null ? firmaPro.foto_firma.location : 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Imagen_no_disponible.svg/600px-Imagen_no_disponible.svg.png'}"
              alt="" class="materialboxed" style="width:50%" >
              `)
              $.ajax({
                    method: 'GET',
                    url: `/api/profesionales/getAllSupervisores/${sedeData}/${firmaPro.supervisorAsign}`,
                    success: function (r){
                    var firmaPro = r
                    $("#superFirma").html(`
                    <img src="${firmaPro.foto_firma != null ? firmaPro.foto_firma.location : 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/Imagen_no_disponible.svg/600px-Imagen_no_disponible.svg.png'}"
                    alt="" class="materialboxed" style="width:50%" >
                    `)

                    } 
                })
              } 
          })
     }

      $("#informeREmision").click(function (event){
        event.preventDefault();
        const sede = $("#sedesRecepcion").val();
        const paciente = $("#user_id").val() || null;
        const fechaSystem = new Date().toISOString()
        const idInformeremision = $('#idInformeremision').val()
        const direccionRemision = $('#direccionRemision').val()
        const idIntervencion = $('#idIntervencion').val()
        const idResultadosRealizados = $('#idResultadosRealizados').val()
        const idRecomendacionesProfesionales = $('#idRecomendacionesProfesionales').val()
        const motivoRemision = $('#motivoRemision').val()
        const psicologoRemite  =  $('#psicologoRemite').val()
        const entidadRemite =   $('#entidadRemite').val()
        const psoclogyFormated = <%- JSON.stringify(user._id) %>;
        const body ={
          sede,
          paciente,
          fechaSystem,
          idInformeremision,
          direccionRemision,
          idIntervencion,
          idResultadosRealizados,
          idRecomendacionesProfesionales,
          motivoRemision,
          psicologoRemite,
          entidadRemite,
          psoclogyFormated

        }
        $.ajax({
                method: "POST",
                url: "/api/pacientes/informeSave",
                data: body,
                success: function (response) {
                    Materialize.toast('Iforme Guardado satisfactoriamente.', 3000, 'rounded green')
                    $("#modalInformeRemision").modal('close')
                    
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    const errors = jqXHR.responseJSON.error.errors;
                    let htmlErrors = "";
                    for (const err in errors) {
                        if (errors.hasOwnProperty(err)) {
                            const error = errors[err];
                            htmlErrors += `<br>${error.message}`
                        }
                    }
                    console.log(textStatus);
                    console.log(errorThrown);
                    Materialize.toast(
                        `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                        10000, 'rounded red');
                }
            })
        
        
       
        

      })


     $("#resumenHC").click(function (event){
      event.preventDefault();
      const sede = $("#sedesRecepcion").val();
        const paciente = $("#user_id").val() || null;
      var fechaIncio = $('#fechaInicio').val()
      var fechaFin = $('#fechaFin').val()
      var numeroDeSesiones = $('#numeroDeSesiones').val()
      var profesionalRemite = $('#profesionalRemite1').val() 
      var insitucionRemite = $('#insitucionRemite1').val() 
      var motivoConsulta = $('#motivoConsulta1').val()
      var lecturaPsicologica = $('#lecturaPsicologica1').val()
      var objetivoIntervecion = $('#objetivoIntervecion1').val()
      let nivelesAbordaje=0,Pareja=0,FamiliaNuclear=0,FamiliaExtensa=0,Redes=0
      var PnivelesAbordaje = $('#nivelesAbordaje').is(':checked')
      var PPareja = $('#Pareja').is(':checked')
      var PFamiliaNuclear = $('#FamiliaNuclear').is(':checked')
      var PFamiliaExtensa = $('#FamiliaExtensa').is(':checked')
      var PRedes = $('#Redes').is(':checked')
            if(PnivelesAbordaje){
              nivelesAbordaje = 1;
            }
            if(PPareja){
              Pareja = 1;
            }
            if(PFamiliaNuclear){
              FamiliaNuclear = 1;
            }
            if(PFamiliaExtensa){
              FamiliaExtensa = 1;
            }
            if(PRedes){
              Redes = 1;
            }
      var logrosAlcanzados = $('#logrosAlcanzados1').val()
      var Recomendaciones = $('#Recomendaciones1').val()
      var numeroDeSesiones = $('#numeroDeSesiones').val()
      var casoRemitido =  $('#casoRemitido1').val()
      var psoclogyFormated = <%- JSON.stringify(user._id) %>; 
      var motivoCierreR = $('#motivoCierre1').val()
      var fechaCreadoR = new Date()
      const body= {
        sede,
        paciente,
        fechaIncio,
        fechaFin,
        casoRemitido,
        profesionalRemite,
        insitucionRemite,
        motivoConsulta,
        lecturaPsicologica,
        objetivoIntervecion,
        nivelesAbordaje,
        Pareja,
        FamiliaNuclear,
        FamiliaExtensa,
        Redes,
        logrosAlcanzados,
        Recomendaciones,
        psoclogyFormated,
        numeroDeSesiones,
        motivoCierreR,
        fechaCreadoR
      }
      $.ajax({
                method: "POST",
                url: "/api/pacientes/resumenHcSave",
                data: body,
                success: function (response) {
                    Materialize.toast('Resumen Guardado satisfactoriamente.', 3000, 'rounded green')
                    $("#modalResumenHC").modal('close')
                    location.reload()
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    const errors = jqXHR.responseJSON.error.errors;
                    let htmlErrors = "";
                    for (const err in errors) {
                        if (errors.hasOwnProperty(err)) {
                            const error = errors[err];
                            htmlErrors += `<br>${error.message}`
                        }
                    }
                    console.log(textStatus);
                    console.log(errorThrown);
                    Materialize.toast(
                        `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                        10000, 'rounded red');
                }
            })
   

     })
      
      $("#btnCierre").click(function (event){
          event.preventDefault();
      const motivoCon = $("#motivoCierre").val()
      const idLogosAlcanzados = $('#idLogosAlcanzados').val()   
      const idDescripcionEmergentes = $('#idDescripcionEmergentes').val()
      const idObservacionSupervisor = $('#idObservacionSupervisor').val() || ""  
      const sede = $("#sedesRecepcion").val();
      const paciente = $("#user_id").val() || null;
      var fechaCierre = new Date()
      var psoclogyFormated = <%- JSON.stringify(user._id) %>;
      var numeroDeSesiones = $('#numeroDeSesionesCierre').val()
      var aprobadoCierre = $("#aprobarCierre").is(":checked")
        const body = {
        sede,
        paciente,
        idLogosAlcanzados,
        idDescripcionEmergentes,
        idObservacionSupervisor,
        motivoCon,
        fechaCierre,
        psoclogyFormated,
        numeroDeSesiones,
        aprobadoCierre
        
      }
      console.log(body)
      $.ajax({
                method: "POST",
                url: "/api/pacientes/cierreSave",
                data: body,
                success: function (response) {
                    Materialize.toast('Cierre Guardado satisfactoriamente.', 3000, 'rounded green')
                    $('#modalCierre').modal('close');
                    //location.href = `/citas?sede=${sede}`
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    const errors = jqXHR.responseJSON.error.errors;
                    let htmlErrors = "";
                    for (const err in errors) {
                        if (errors.hasOwnProperty(err)) {
                            const error = errors[err];
                            htmlErrors += `<br>${error.message}`
                        }
                    }
                    console.log(textStatus);
                    console.log(errorThrown);
                    Materialize.toast(
                        `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                        10000, 'rounded red');
                }
            })
      })


      $("#btnseguimiento").click(function (event) {
        
          event.preventDefault();
          const sede = $("#sedesRecepcion").val();
          const paciente = $("#user_id").val() || null;
          const typecontrato = $('#typecontrato').val()
          const continuarProceso = $('#continuarProceso').val()
          const percepcion = $('#percepcion').val()
          const cambiosIdentificados = $('#cambiosIdentificados').val()
          const proyectosFuturos = $('#proyectosFuturos').val()
          const observacionesPsicologo = $('#observacionesPsicologo').val()
          var fechaSystem = new Date()
          var psoclogyFormated = `${<%- JSON.stringify(user.nombre) %>} ${ <%- JSON.stringify(user.apellido) %>}`;

          const body = {
            sede,
            paciente,
            typecontrato,
            continuarProceso,
            percepcion,
            cambiosIdentificados,
            proyectosFuturos,
            observacionesPsicologo,
            fechaSystem,
            psoclogyFormated
          }
          $.ajax({
                method: "POST",
                url: "/api/pacientes/seguimientoSave",
                data: body,
                success: function (response) {
                    Materialize.toast('Seguimiento Guardado satisfactoriamente.', 3000, 'rounded green')
                    $('#modalSeguimiento').modal('close');
                    //location.href = `/citas?sede=${sede}`
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    const errors = jqXHR.responseJSON.error.errors;
                    let htmlErrors = "";
                    for (const err in errors) {
                        if (errors.hasOwnProperty(err)) {
                            const error = errors[err];
                            htmlErrors += `<br>${error.message}`
                        }
                    }
                    console.log(textStatus);
                    console.log(errorThrown);
                    Materialize.toast(
                        `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                        10000, 'rounded red');
                }
            })
            if(continuarProceso == 'NO'){
                desabilidar()
            }
          
      })
      

    
      $("body").on("click",".saveRow", function(ev){
        var formData = new FormData();
        var tr = $('table').closest('tr');
        var fup = $('tr').find("input[type='file']");
        var totalFiles = fup.length;    
        let sede = $("#sedesRecepcion").val();
        for (var i = 0; i < totalFiles; i++) {
            var file = fup[i].files[0];//Exception will not occur here
            if(file == undefined){
              alert('Debe selecionar un archivo para cargar');
              return;
            }else if(fup[i].files[0].size / 1024 / 1024 > 5){              
              alert('La imagen es demaisado grande. (Tamaño Máximo: 5 MB)');
              return;
            }
            const campo_id = 'cargue_documento';
            const tipo = 'cargue_de_documento';
            const Paciente = <%- JSON.stringify(paciente._id) %>;
            formData.append("archivo", file);
            const urlEnvio = `/api/archivos?sede=${sede}&tipo=${tipo}&tipo_id=${Paciente}&campo_id=${campo_id}`
            var row = $(this).parents(".tabrow");
            let count = 0, tipoDocumento = "", descripcionDocumento = "";
            // update the cells
            row.find("td").each(function(){
              var newVal = $(this).find("input").val();
              switch (count) {
                case 0:
                  tipoDocumento = newVal;
                  break;
                case 1:
                  descripcionDocumento = newVal;
                  break;
              
                default:
                  break;
              }
              count++;
            });
            console.log(">>>>", tipoDocumento, descripcionDocumento)
            if(tipoDocumento == ""){
              Materialize.toast('Seleccione una opcion en el Tipo Documento', 2000, 'rounded red')
              return;
            }
            if(descripcionDocumento == ""){
              Materialize.toast('Escribir una descripcion.', 2000, 'rounded red')
              return;
            }
            //var creado_timestamp = new Date.now();

            Materialize.toast('Subiendo Imagen.', 2000, 'rounded blue')
            console.log('Imagen Aceptada');
            $.ajax({
                    url: urlEnvio,
                    type: 'POST',
                    data: formData,
                    processData: false, // tell jQuery not to process the data
                    contentType: false, // tell jQuery not to set contentType
                    enctype: 'multipart/form-data',
                    success: function (data) {
                        Materialize.toast('Imagen subida con éxito.', 2000, 'rounded green')
                        /** TODO Probrar el guardado junto con el de paciente 
                         en la tabla nueva CargueDocumentoSchema 
                        */
                      const urlDocumento = data.data.location
                      console.log(">>>> urlDocumento: ", urlDocumento)
                      const body = {
                        sede,
                        Paciente,
                        tipoDocumento,
                        descripcionDocumento,
                        urlDocumento
                      }

                        $.ajax({
                          method: "POST",
                          url: '/api/carguedocumento/create',
                          data: body,
                          success: function (response) {
                              Materialize.toast('Archivo(s) cargados.', 3000, 'rounded green')
                              const id = urlParams.get('id')
                              setTimeout(function () {
                                  location.href = `pacientes/ver?id=${id}`
                              }, 2000);
                          },
                          error: function (jqXHR, textStatus, errorThrown) {
                              const errors = jqXHR.responseJSON.error.errors;
                              let htmlErrors = "";
                              for (const err in errors) {
                                  if (errors.hasOwnProperty(err)) {
                                      const error = errors[err];
                                      htmlErrors += `<br>${error.message}`
                                  }
                              }
                              console.log(textStatus);
                              console.log(errorThrown);
                              Materialize.toast(
                                  `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                                  10000, 'rounded red');
                          }
                        })
                    },
                    error: function (a, b, c) {
                        Materialize.toast('Hubo un error al subir el archivo.', 4000,
                            'rounded blue')
                        console.error(a, b, c)
                    }
            });
        }
         console.log(">>>>>>> Funciona") 
      });

    $(document).ready(function () {

      $("#enviar_data").click(function() {
        saveData();       
        
    })
    



      $('.modal').modal();
      
     $("#comp_Parentesco").change(function (e) {
        let value = String($(this).val())
         if(value === "OT"){
           $('#otroShow').html(`<div class="input-field col m3 s12" id="input_otro">
                                <input id="otro" type="text"  value="<%= paciente.acompanante_parentezco_otro %>" class="validate">  
                                <label for="otro">Otro <span style="color:red">*</span></label>
                              </div>`)
           $('#input_otro').show();
         } else{
            $('#input_otro').hide();
         }
    });

      $('#pais').material_select();
       $('#disabled').attr("disabled",true);

    



     


	   
    
     


        console.log('Preparado para enviar');
        $('#identificacion').characterCounter();
        $('#comp_identificacion').characterCounter();

         $('#pais').change(function(e){
           

	        
              $('.localidad0').show();
              $('.select-wrapper.localidadSelect2').hide();

            $('#municipio').html(`<option value="" disabled selected>Elige una opción</option>`)
            var pais = $(this).val();
            //alert(pais);


              if(pais===""){

              	 $('.departamentosSelect1').show();
                 $('.select-wrapper.departamentosSelect2').hide();
                 $('.departamentosInput').hide();
	             $('.departamentosInput').attr("disabled",true);

	             $('.select-wrapper.municipiosSelect2').show();
	   			 $('.municipiosInput').hide();
	   			 $('.municipiosInput').val("");
	             $('.municipiosInput').attr("disabled",true);
              }
              else if(pais==="Colombia"){
                  depart=1;
                  locali=0;
                  munici=0;
                  $('#ocultar_departamento').show();
                  $('.provincia').hide();

                 $('.departamentosSelect1').hide();
                 $('.select-wrapper.departamentosSelect2').show();
                 $('.departamentosInput').hide();
	   			       $('.departamentosInput').val("");
	               $('.departamentosInput').attr("disabled",true);
	               $('.select-wrapper.municipiosSelect2').show();
                 $('.municipiosInput').hide();
                 $('.municipiosInput').val("");
	               $('.municipiosInput').attr("disabled",true);
                 var departamentos = <%- JSON.stringify(departamentos) %>;
               
                 departamentos.sort(function (a, b) {
                  if (a.Nombre > b.Nombre) {
                      return 1
                  } else if (a.Nombre < b.Nombre) {
                    return -1
                  } else {
                  return 0
                 }
                 })
                 for (let i = 0; i < departamentos.length; i++) {
                 const depa = departamentos[i];
                 $('#departamento').append(`<option value="${depa.Codigo}">${depa.Nombre}</option>`);
               } 
                                          
     
	          }
            else if(pais==="Ecuador"){
              
                
              $('.provincia').show()
              $('#ocultar_departamento').hide();
                 $('.departamentosSelect1').hide();
                 $('.departamentosInput').hide();
	   			       $('.departamentosInput').val("");
	             
               var provincia = <%- JSON.stringify(provincia) %>;
               
               provincia.sort(function (a, b) {
                if (a.Nombre > b.Nombre) {
                    return 1
                } else if (a.Nombre < b.Nombre) {
                  return -1
                } else {
                return 0
               }
               })
               for (let i = 0; i < provincia.length; i++) {
               const prov = provincia[i];
               $('#provincia').append(`<option value="${prov.Codigo}">${prov.Nombre}</option>`);
             } 
                 
              
            }
	          else{
            depart=0;
            locali=0;
            munici=0;

           
            $('#departamento').hide();
                 $('.departamentosSelect1').hide();
	             $('.departamentosInput').show();
	   			 $('.departamentosInput').val("");
	             $('.departamentosInput').attr("disabled",false);
	             $('.select-wrapper.departamentosSelect2').hide();



	            $('.select-wrapper.municipiosSelect2').hide();
              
	   			$('.municipiosInput').show();
	   			$('.municipiosInput').val("");
	            $('.municipiosInput').attr("disabled",false);
       			
	          }

        })


        $("#recepcionData").click(function (event) {
          event.preventDefault();
          
          const sede = $("#sedesRecepcion").val();
          const Paciente = $("#user_id").val() || null
          const fechaSystem = new Date().toISOString()
          const psoclogyFormated = `${<%- JSON.stringify(user.nombre) %>} ${ <%- JSON.stringify(user.apellido) %>}`;
          const caseRemition = $("#remision").val()
          const typeInstitution = $("#tipIntitucion").val()
          const institutionRemision = $("#IAB_tipIntitucion").val() || $("#IG_tipIntitucion").val() || $("#IAS_tipIntitucion").val() || $("#OI_tipIntitucion").val() 
          const nameInstitution = $("#nameInstitution").val()
          const nameInstitutionRemite = $("#nameInstitutionRemite").val()
          const motiveRemision = $("#motiveRemision").val()
          const motiveConsulta = $("#motiveConsulta").val()
          const anotacion1 = $("#anotacion_caso").val()
          const anotacion2 = $("#comprension_entrevistador").val()
          const anotacion3 = $("#acuerdo_intervencion").val()
          const observacion = $("#observacion").val()
          //const terapeutaAsign = $("#tpAsignado").val()
          const userid = new URLSearchParams(window.location.search).get('id')

          const body = {
            sede,
            Paciente,
            fechaSystem,
            psoclogyFormated,
            caseRemition,
            typeInstitution,
            institutionRemision,
            nameInstitution,
            nameInstitutionRemite,
            motiveRemision,
            motiveConsulta,
            anotacion1,
            anotacion2,
            anotacion3,
            observacion
          }
          
          $.ajax({
                method: "POST",
                url: "/api/pacientes/recepcionPaciente",
                data: body,
                success: function (response) {
                    Materialize.toast('Recepcion Guardada satisfactoriamente.', 3000, 'rounded green')
                    $('#modal1').modal('close');

                    if(<%- JSON.stringify(user.roles=='PG') %>){
                    }else{
                      location.href = `/citas/indexUni?sede=${sede}&paciente=${Paciente}`
                    }
                    
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    const errors = jqXHR.responseJSON.error.errors;
                    let htmlErrors = "";
                    for (const err in errors) {
                        if (errors.hasOwnProperty(err)) {
                            const error = errors[err];
                            htmlErrors += `<br>${error.message}`
                        }
                    }
                    console.log(textStatus);
                    console.log(errorThrown);
                    Materialize.toast(
                        `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                        10000, 'rounded red');
                }
            })
          
          
        })


        
        $('#departamento').change(function(e){
              $('.localidad1').show();
              $('.select-wrapper.localidadSelect2').hide();
            var municipios = getMunicipios(String($(this).val()))
            $('#municipio').html(`<option value="" disabled selected>Elige una opción</option>`)
            municipios.sort(function (a, b) {
            if (a.Municipio > b.Municipio) {
                return 1
            } else if (a.Municipio < b.Municipio) { return -1 } else { return 0 } })
            for (let i = 0; i < municipios.length; i++) {
                const muni = municipios[i];
                $('#municipio').append(`<option value="${muni.Cod_muni}">${muni.Municipio}</option>`)
            }
            $('#municipio').material_select();
            if($(this).val()=="11"){
                  locali=0;
                  munici=1;
            }
            else{

                  locali=0;
                  munici=0;
            }

        })
        $('#provincia').change(function (e){
            
            var cantones = getCantones(String($(this).val()))
            $('#canton').html(`<option value="" disabled selected>Elige una opción</option>`)
            cantones.sort(function (a, b) {
            if (a.cantones > b.cantones) {
                return 1
            } else if (a.cantones < b.cantones) { return -1 } else { return 0 } })
            for (let i = 0; i < cantones.length; i++) {
                const can = cantones[i];
                $('#canton').append(`<option value="${can.Codigo_cat}">${can.canton_name}</option>`)
            }
            $('#canton').material_select();

          })
          cantonElegido = $('#canton').val()
         $('#municipio').change(function(e){
            var dp=$('#departamento').val();
            console.log(">>> municipo departamento: ", dp)
            var mn=$(this).val();
            if(mn=="001" && dp=="11"){
               locali=1;
               $('.localidad1').hide();
               $('.localidad0').hide();
               $('.select-wrapper.localidadSelect2').show();
            }
            else{
              locali=0;
              $('.localidad1').show();
              $('.select-wrapper.localidadSelect2').hide();
            }
         });  
        $("#fecha_nacimiento").change(function(e){
          console.log("Cambio de fecha")
            $('#tipEdad').val('')
            var valueBirth = ($("#fecha_nacimiento").val())
            .replace('Enero', 'Jan')
            .replace('Abril', 'Apr')
            .replace('Agosto', 'Aug')
            .replace('Diciembre', 'Dec')
            var a = moment();
            var b = moment(valueBirth);
            var age = moment.duration(a.diff(b));
            var years = age.years();
            if(years > 0){
                if (years < 6) { 
                    rango = "PRIMERA INFANCIA"
                } else if (years < 12) {
                    rango = "INFANCIA"
                } else if (years < 18) {
                    rango = "ADOLESCENCIA"
                } else if (years < 27) {
                    rango = "JUVENTUD"
                } else if (years < 61) {
                    rango = "ADULTEZ"
                } else {
                    rango = "ADULTEZ MAYOR"
                }
                $('#tipEdad').val(`${rango}`)
            }
            //console.log(valueBirth, years, age.years())
            $('#edad').val(`${years} años`)
        })
        
        $('#tipo_id').change(function (e) {
            var tipo_id_abbr = $(this).val();
            switch (tipo_id_abbr) {
                case 'CC':
                    $('#identificacion').attr('data-length', '10')
                    break;
                case 'CE':
                    $('#identificacion').attr('data-length', '6')
                    break;
                case 'CD':
                    $('#identificacion').attr('data-length', '16')
                    break;
                case 'PA':
                    $('#identificacion').attr('data-length', '16')
                    break;
                case 'PE':
                    $('#identificacion').attr('data-length', '15')
                    break;
                case 'RC':
                    $('#identificacion').attr('data-length', '11')
                    break;
                case 'TI':
                    $('#identificacion').attr('data-length', '11')
                    break;
                case 'CN':
                    $('#identificacion').attr('data-length', '9')
                    break;
                case 'AS':
                    $('#identificacion').attr('data-length', '10')
                    break;
                case 'MS':
                    $('#identificacion').attr('data-length', '12')
                    break;
                case 'SC':
                    $('#identificacion').attr('data-length', '16')
                    break;
                default:
                    $('#identificacion').removeAttr('data-length')
                    break;
            }
            // $('#identificacion').val('');
            $('#identificacion').characterCounter();
        })
        
        $('#tipo_id_acompanate').change(function (e) {
            var tipo_id_abbr = $(this).val();
            switch (tipo_id_abbr) {
                case 'CC':
                    $('#comp_identificacion').attr('data-length', '10')
                    break;
                case 'CE':
                    $('#comp_identificacion').attr('data-length', '6')
                    break;
                case 'CD':
                    $('#comp_identificacion').attr('data-length', '16')
                    break;
                case 'PA':
                    $('#comp_identificacion').attr('data-length', '16')
                    break;
                case 'PE':
                    $('#comp_identificacion').attr('data-length', '15')
                    break;
                case 'RC':
                    $('#comp_identificacion').attr('data-length', '11')
                    break;
                case 'TI':
                    $('#comp_identificacion').attr('data-length', '11')
                    break;
                case 'CN':
                    $('#comp_identificacion').attr('data-length', '9')
                    break;
                case 'AS':
                    $('#comp_identificacion').attr('data-length', '10')
                    break;
                case 'MS':
                    $('#comp_identificacion').attr('data-length', '12')
                    break;
                case 'SC':
                    $('#comp_identificacion').attr('data-length', '16')
                    break;
                default:
                    $('#comp_identificacion').removeAttr('data-length')
                    break;
            }
            // $('#identificacion').val('');
            $('#comp_identificacion').characterCounter();
        })




        const dataexel = <%- JSON.stringify(trabajos) %>;
      //console.log(dataexel);

        console.log(dataexel);

      $('#ocupacion').html(`<option value="" disabled selected>Elige una opción Ocupación</option>`);

      for (let trabajos of dataexel) {
        $('#ocupacion').append(`<option value="${trabajos['Descripción']}">${trabajos['Descripción']}</option>`);
        //console.log(trabajos['Descripción']);
      }
      $('#ocupacion').material_select();


      function saveData () {
            const url = '/api/pacientes/update';
            const method = 'PATCH'

            const user_id = $("#user_id").val() || null;
            const primer_nombre = $('#primer_nombre').val();
            const segundo_nombre = $('#segundo_nombre').val();
            const primer_apellido = $('#primer_apellido').val();
            const segundo_apellido = $('#segundo_apellido').val();
            const nombre = `${primer_nombre} ${segundo_nombre}`;
            const apellido = `${primer_apellido} ${segundo_apellido}`;;
            const code = $('.iti__selected-dial-code').html();
            const phone = $('#phone').val();

            const cell = $('#cell').val();

            const telefono = code.substring(4, 1) + phone;
            const celular = code.substring(4, 1) + cell;
            const email = $("#email").val() || "";
            const genero_nacimiento = $("#genero").val() || "";
            const identidad_sexual = $("#isex").val() || "";
            const escolaridad = $("#escolaridad").val() || "";
            const estado_civil = $("#estado_civil").val() || "";
            const ocupacion = $("#ocupacion").val() || "";
            const pais = $('#pais').val();
            const provincia = $('#provincia').val();
            const canton = $('#canton').val();

            const acompanante_nombre = $("#comp_Nombrecompleto").val() || "";
            const acompanante_tipo_identificacion = $("#tipo_id_acompanate").val() || "DNI";
            const acompanante_identificacion = $("#comp_identificacion").val() || "";
            const acompanante_parentezco = $("#comp_Parentesco").val() || "DNI";
            const acompanante_parentezco_otro = $("#otro").val() || "";
            const acompanante_telefono = $("#comp_telefono").val() || "";
            const acompanante_correo = $("#comp_email").val() || "prueba@gmail.com";
           

            
            let permisosUsers_CreateCitas = 0, permisosUsers_DescargaCertificado = 0, 
                permisosUsers_DescargaRemisiones = 0, permisosUsers_DescargaHistorialClinico = 0, 
                permisosUsers_AnexarDocumento = 0, permisosUsers_autoreporte = 0, permisosUsers_FirmaConsentimiento = 0, permisosUsers_editarInfo = 0;

            const vlrFirmaConsentimiento = $("#Firma_consInformado").is(':checked');
            const vrlCreateCita = $("#Create_Cita").is(':checked');
            const vlrDescargaCertificado = $("#download_Certificate").is(':checked');
            const vlrDescargaRemision = $("#donwload_Remision").is(':checked');
            const vlrDescarHistoricoClinico = $("#dowload_history").is(':checked');
            const vlrAnexarDocumento = $("#anexar_documentos").is(':checked');
            const vlrautoreporte = $("#autoReportCondition").is(':checked');
            const vlreditInfor = $("#editDataIfno").is(':checked');

            if(vlrFirmaConsentimiento){
                permisosUsers_FirmaConsentimiento = 1;
            }
            if(vrlCreateCita){
                permisosUsers_CreateCitas = 1;
            }
            if(vlrDescargaCertificado){
                permisosUsers_DescargaCertificado = 1;
            }
            if(vlrDescargaRemision){
                permisosUsers_DescargaRemisiones = 1;
            }
            if(vlrDescarHistoricoClinico){
                permisosUsers_DescargaHistorialClinico = 1;
            }
            if(vlrAnexarDocumento){
                permisosUsers_AnexarDocumento = 1;
            }
            if(vlrautoreporte){
                permisosUsers_autoreporte = 1;
            }
            if(vlreditInfor){
              permisosUsers_editarInfo = 1;
            }



            var departamento = $('#departamento').val();
            var municipio = $('#municipio').val();
            var localidad;
            // if(depart==0){
            //   departamento = $('input.departamento1').val();
            // }
            // else{
            //   departamento = $('select.departamentosSelect2').val();
            // }

            // if(munici==0){
            //   municipio = $('input.municipio1').val();
            // }
            // else{
            //   municipio = $('select.municipiosSelect2').val();
            // }


            if(locali==0){
              localidad = $('input.localidad1').val();
            }
            else{
              localidad = $('select.localidadSelect2').val();
            }

  
            console.log(">>>>>> Deparamento, municipio: ", $('#departamento').val(), $('#municipio').val())



            const zona = $('#zona').val();
            const direccion = $("#direccion").val() || "";
            const estrato = $("#estrato").val() || "";
            const rh = $('#rh').val() || "";
            const eps = $('#eps').val() || "";
            const regimen_salud = $('#regimen_salud').val() || "";
            const pertenencia_etnica = $('#pertenencia_etnica').val() || "";
            const tipo_id = $('#tipo_id').val() || "";
            const nacimiento_value = ($("#fecha_nacimiento").val())
                .replace('Enero', 'Jan')
                .replace('Abril', 'Apr')
                .replace('Agosto', 'Aug')
                .replace('Diciembre', 'Dec') ||
                '1 Jan, 2000';
            const nacimiento_arr = nacimiento_value.split('-');
            const dd_nacimiento = nacimiento_arr[2];
            const mm_nacimiento = nacimiento_arr[1];
            const yyyy_nacimiento = nacimiento_arr[0];
            const fecha = `${yyyy_nacimiento}/${mm_nacimiento}/${dd_nacimiento}`
            const ts_nacimiento = moment(fecha).unix()
            const Sedes = $("#sedesRecepcion").val();
            const urlParams = new URLSearchParams(window.location.search);

            const body = {
                user_id,
                primer_apellido,
                segundo_apellido,
                primer_nombre,
                segundo_nombre,
                pais,
                departamento,
                municipio,
                provincia,
                canton,
                localidad,
                zona,
                rh,
                regimen_salud,
                eps,
                pertenencia_etnica,
                tipo_id,
                nombre,
                apellido,
                yyyy_nacimiento,
                mm_nacimiento,
                dd_nacimiento,
                ts_nacimiento,
                genero_nacimiento,
                identidad_sexual,
                escolaridad,
                estado_civil,
                ocupacion,
                direccion,
                estrato,
                telefono,
                celular,
                email,              
                acompanante_nombre,
                acompanante_tipo_identificacion,
                acompanante_identificacion,
                acompanante_parentezco,
                acompanante_parentezco_otro,
                acompanante_telefono,
                acompanante_correo,
                permisosUsers_FirmaConsentimiento,
                permisosUsers_CreateCitas,
                permisosUsers_DescargaCertificado,
                permisosUsers_DescargaRemisiones,
                permisosUsers_DescargaHistorialClinico,
                permisosUsers_AnexarDocumento,
                permisosUsers_autoreporte,
                permisosUsers_editarInfo
            }
                
            /*
            /////////////////////////////////////////////////////////////////////////////
            ////////////////////////// ACTUALIZAR DPACIENTE /////////////////////////////
            /////////////////////////////////////////////////////////////////////////////
            */
            

            $.ajax({
                method: method,
                url: url,
                data: body,
                success: function (response) {
                    Materialize.toast('Usuario actualizado con éxito.', 3000, 'rounded green')
                    const id = urlParams.get('id')
                    setTimeout(function () {
                        location.href = `/pacientes/ver?id=${id}`
                    }, 2000);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    const errors = jqXHR.responseJSON.error.errors;
                    let htmlErrors = "";
                    for (const err in errors) {
                        if (errors.hasOwnProperty(err)) {
                            const error = errors[err];
                            htmlErrors += `<br>${error.message}`
                        }
                    }
                    console.log(textStatus);
                    console.log(errorThrown);
                    Materialize.toast(
                        `Hubo un error en los datos proporcionados.<br>Verificar e Intentar de nuevo.<br>${htmlErrors}`,
                        10000, 'rounded red');
                }
            })

        }

      $('#downloadHistory').click(function(){
        var values = {};

        $('#tabla_historias').find('input[type=checkbox]').each(function(i) {
          var checkbox = $(this);
          if(checkbox.is(':checked')){
            values[i] = [];
            values[i].push($(this).attr('id'));
          }
        });

        var body = {
          user_id: $("#user_id").val() || null,
          sede: $("#sedesRecepcion").val(),
          id: values
        }


        $.ajax({
          method: 'POST',
          url: `/api/historias-clinicas/print`,
          dataType: 'json',
          contentType: 'application/json',
          data: JSON.stringify(body),
          success: function (r) {
              console.log(">>>> print: ", r)
          }
        })
      });
        

      
      let idUser = $("#user_id").val() || null;
      let sedeData = $("#sedesRecepcion").val();
      var idprofe = <%- JSON.stringify(paciente.idProfesional) %>
      $.ajax({
          method: 'GET',
          url: `/api/profesionales?sede=${sedeData}&projection=nombre+apellido+username+email+-Sedes+roles+usuario+-SedeUserInfos+-Encargados`,
          success: function (r) {
              for (let i = 0; i < r.length; i++) {
                  const formulario = r[i];
                  if(formulario.roles == 'PG'){
                    $('#profeAsig').append(
                      `<option ${formulario._id == idprofe ? 'selected' : ''}  value="${formulario._id}">${formulario.nombre} ${formulario.apellido}</option>`)
               
                  }   
              }
              $('#profeAsig').material_select();
          }
      });

      $('#tpAsignado').val("");
      $('#dc_Asignado').val("");
      /* Obtener Profesionales-Estudiante */
      $.ajax({
          method: 'GET',
          url: `/api/profesionales/terapeuta?filter[sede]=${sedeData}&limit=1000000&projection=nombre+apellido+username+-Sedes+-Encargados+-SedeUserInfos`,
          success: function (r) {
              //console.log(">>>> terapeuta: ", r)
              for (let i = 0; i < r.length; i++) {
                  const formulario = r[i];
                  $('#tpAsignado').append(
                      `<option value="${formulario._id}">${formulario.nombre} ${formulario.apellido}</option>`)
              }
              $('#tpAsignado').material_select();
          }
      })

      /* Obtener Informes*/
      $.ajax({
        method: 'GET',
        url: `/api/pacientes/informeGet/${sedeData}/${idUser}`,
        success: function (r){
          //var disabled = "disabled";
          var disabled = false;
          // var mostrarBtnImprmir ="disabled"
          var mostrarBtnImprmir = ""
          for(let i = 0; i < r.length; i++){          
            var options = {weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "numeric", hour12:"false", minute: "numeric"};
            var fecha = new Date(r[i].fechaSystem)
            r[i].fechaSystem =  fecha.toLocaleString ("es-ES", options) 
            var idDelUsuario = r[i].paciente
             $("#tabla_informes").append(`
             <tr class='tabrow closed'>
             <td>
              ${r[i].fechaSystem}
             </td>
             <td>
             ${r[i].psoclogyFormated.nombre} ${r[i].psoclogyFormated.apellido}
             </td>
             <td>
              <a href="/descargarInformes/informe?info=${r[i]._id}" target="_blank" class="modal-action  modal-close waves-effect waves-blue btn-flat blue waves-light" ${mostrarBtnImprmir}>Imprimir</a>
             </td>
             </tr>
             `)
          }
        }
      })
      $.ajax({
        method: 'GET',
        url: `/api/pacientes/resumenHcGet/${sedeData}/${idUser}`,
        success: function(r){
          for(let a = 0; a < r.length; a++){
            var options = {weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "numeric", hour12:"false", minute: "numeric"};
            var fecha = new Date(r[a].fechaCreadoR)
            r[a].fechaCreadoR =  fecha.toLocaleString ("es-ES", options) 
           
             $("#tabla_resumeHc").append(`
             <tr class='tabrow closed'>
             <td>
              ${r[a].fechaCreadoR}
             </td>
             <td>
             ${r[a].psoclogyFormated.nombre} ${r[a].psoclogyFormated.apellido}
             </td>
             <td>
              <a href="/descargarInformes/resumen?resu=${r[a]._id}" target="_blank" class="modal-action modal-close waves-effect waves-blue btn-flat blue waves-light">Imprimir</a>
            </td>
          </tr>
              `)
            }
        }
      })
      $.ajax({
        method: 'GET',
        url: `/api/pacientes/cierreGet/${sedeData}/${idUser}`,
        success: function(r){
          console.log(r)
          for(let j = 0; j < r.length; j++){
            var options = {weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "numeric", hour12:"false", minute: "numeric"};
            var fecha = new Date(r[j].fechaCierre)
            r[j].fechaCierre =  fecha.toLocaleString ("es-ES", options) 
            
             $("#tabla_cierre").append(`
             <tr class='tabrow closed'>
             <td>
              ${r[j].fechaCierre}
             </td>
             <td>
             ${r[j].psoclogyFormated.nombre} ${r[j].psoclogyFormated.apellido}
             </td>
             <td>
              <a href="/descargarInformes/cierre?cierre=${r[j]._id}" target="_blank" class="modal-action  modal-close waves-effect waves-blue btn-flat blue waves-light">Imprimir</a>
              </td>`)
            }
        }
      })
      /* Obtener Seguimiento */
      $.ajax({
        method: 'GET',
        url: `/api/pacientes/seguimientoGet/${sedeData}/${idUser}`,
        success: function(response){
          for(let s=0;s<=response.length;s++){
            var options = {weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "numeric", hour12:"false", minute: "numeric"};
            var fecha = new Date(response[s].fechaSystem)
            response[s].fechaSystem =  fecha.toLocaleString ("es-ES", options) 
            $('#tabla_seguimiento').append(`
            <tr class="tabrow closed">
              <td>
                ${response[s].fechaSystem}             
              </td>
              <td>
                ${response[s].psoclogyFormated}             
              </td>
              <td>
               <button data-target="modalS_${s}" class="btn edit_data1 modal-trigger waves-effect btn-flat col  s10 btn waves-effect primary waves-light">Abrir</button>
               <input disabled id="usuarioS_${s}" type="hidden" value="${response[s]._id}" class="validate"> 
               <div class="modal" id="modalS_${s}">
                 <div class="modal-content">
                 <div class="modal-header"></div>
                 <div class="modal-content">
                <div class="row" style="background-color: #D9D9D9;">
                  <center>
                    <p><strong> Seguimiento </strong></p>
                  </center>
                  <p style="text-align: left; width: 100%" > 
                   ${pacienteHeard}
                  </p>
                 </div><br>
                 <div class="row">
                     <div class="col s6">
                      Fecha: ${response[s].fechaSystem}  
                    </div>
                  </div>
                  <div class="row">
                      <div class="col s6">Tipo de contacto:     </div>
                      <div class="col s6">
                        <textarea type="text" name="" id="" type="text" 
                    class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
                    data-tooltip="Observaciones y apreciaciones del supervisor." readonly>${response[s].typecontrato}</textarea>
                      </div>
                      <div class="col s6">¿Desea continuar con el proceso?: </div>
                      <div class="col s6">
                        <textarea type="text" name="" id="" type="text" 
                    class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
                    data-tooltip="Observaciones y apreciaciones del supervisor." readonly>${response[s].continuarProceso}</textarea>
                    </div>
                    </div>
                    <div class="row">
                      <div class="col s6"> Percepción de la situación actual:</div>
                      <div class="col s12">
                        <textarea type="text" name="" id="percepcion_${s}" type="text" 
                    class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
                    data-tooltip="Observaciones y apreciaciones del supervisor." >${response[s].percepcion}</textarea>
                    </div>
                    </div>
                    <div class="row">
                      <div class="col s6"> Percepción de la situación actual:</div>
                      <div class="col s12">
                        <textarea type="text" name="" id="cambiosIdentificados_${s}" type="text" 
                    class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
                    data-tooltip="Observaciones y apreciaciones del supervisor." >${response[s].cambiosIdentificados}</textarea>
                    </div>
                    </div>
                    <div class="row">
                      <div class="col s6"> Percepción de la situación actual:</div>
                      <div class="col s12">
                        <textarea type="text" name="" id="proyectosFuturos_${s}" type="text" 
                    class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
                    data-tooltip="Observaciones y apreciaciones del supervisor." >${response[s].proyectosFuturos}</textarea>
                    </div>
                    </div>
                    <div class="row">
                      <div class="col s6"> Percepción de la situación actual:</div>
                      <div class="col s12">
                        <textarea type="text" name="" id="observacionesPsicologo_${s}" type="text" 
                    class=" materialize-textarea validate clean_on_create tooltipped" data-position="top" data-delay="50"
                    data-tooltip="Observaciones y apreciaciones del supervisor." >${response[s].observacionesPsicologo}</textarea>
                    </div>
                    </div>

                    <form class="col s12">
                      <div class="row">
                        <div class="col s4">
                          <div class="modal-footer">
                          <a class="modal-action saveS_${s} modal-close waves-effect waves-green btn-flat green waves-light">Guardar</a>
                          </div>
                        </div>
                        <div class="col s6">
                          <div class="modal-footer">
                          <a class="modal-action imprimirS_${s} modal-close waves-effect waves-blue btn-flat blue waves-light">Descargar</a>
                          </div>
                        </div>
                      </div>
                    </form>

                 </div>
                 </div>
               </div>              
              </td>
            <tr>
            `)
            $(document).on('click', `.saveS_${s}`, function () {
              
              const percepcion = $(`#percepcion_${s}`).val()
              const cambiosIdentificados = $(`#cambiosIdentificados_${s}`).val()
              const proyectosFuturos = $(`#proyectosFuturos_${s}`).val()
              const observacionesPsicologo = $(`#observacionesPsicologo_${s}`).val()
              const _id = response[s]._id
              const body= {
                _id,
                percepcion,
                cambiosIdentificados,
                proyectosFuturos,
                observacionesPsicologo
                
              }
              $.ajax({
              method: "PATCH",
              url: `/api/pacientes/seguimientoUp/${_id}`,
              data: body,
              success: function (response) {
                  Materialize.toast('Seguimiento Guardado satisfactoriamente.', 3000, 'rounded green')
                  $(`#modalS_${s}`).modal('close')
                    //window.location.reload();
              },
          })        
            });

                    $(document).on('click', `.imprimirS_${s}`, function () {
                    
                    pdfdoc.fromHTML($(`#modalS_${s}`).html(), 10, 10, {
                      'width': 150,
                      'elementHandlers': specialElementHandlers
                      });

                      pdfdoc.save(`Seguimiento De ${NombreCompleto}.pdf`);
                      window.location.reload();
                  });
          }
        }
      })
      
      /* Obtener Documentos */
      if(sedeData == '60049afed00d9b43a49e4da7'){
        $.ajax({
          method: 'GET',
          url: `/api/carguedocumento/getDocumentos/${sedeData}/${idUser}`,
          success: function (r) {
              for(let j = 0; j < r.length; j++){
                $("#table_documentPacient").append(`
                          <tr class='tabrow closed'>
                              <td>
                                <select disabled id="tipDocumentAdd_${j}" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option value="FC"${r[j].tipoDocumento == 'Fotocopia de cédula (de los integrantes)' ? 'selected' : ''}>Fotocopia de cédula (de los integrantes)</option>
                                        <option value="CYA"${r[j].tipoDocumento == 'CONSENTIMIENTO INFORMADO' ? 'selected' : '' }>CONSENTIMIENTO INFORMADO</option>
                                        <option value="CYA"${r[j].tipoDocumento == 'ASENTIMIENTO INFORMADO' ? 'selected' : '' }>ASENTIMIENTO INFORMADO</option>
                                        <option value="RDP"${r[j].tipoDocumento == 'PRIMER RECIBO DE PAGO' ? 'selected' : '' }>PRIMER RECIBO DE PAGO</option>
                                        <option value="RDP"${r[j].tipoDocumento == 'Autorizacionción de datos personales' ? 'selected' : '' }>Autorizacionción de datos personales</option>
                                        <option value="HCE"${r[j].tipoDocumento == 'ACTA DE DEFUNCIÓN' ? 'selected' : '' }>ACTA DE DEFUNCIÓN</option>
                                        <option value="TI"${r[j].tipoDocumento == 'TARJETA IDENTIDAD PARA MAYOR DE 7 AÑOS' ? 'selected' : '' }>TARJETA IDENTIDAD PARA MAYOR DE 7 AÑOS</option>
                                        <option value="RCT"${r[j].tipoDocumento == 'REGISTRO CIVIL (Para todo menor de edad)' ? 'selected' : '' }>REGISTRO CIVIL (Para todo menor de edad)</option>
                                        <option value="DCC"${r[j].tipoDocumento == 'DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO.' ? 'selected' : '' }>DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO.</option>
                                        <option value="DIU"${r[j].tipoDocumento == 'DOCUMENTO INCRUSTADO (ESTABLECER LOS DOCUMENTOS A CARGAR DE MANERA COMPILADA EN UN SOLO ARCHIVO) ' ? 'selected' : '' }>DOCUMENTO INCRUSTADO (ESTABLECER LOS DOCUMENTOS A CARGAR DE MANERA COMPILADA EN UN SOLO ARCHIVO) </option>
                                    </select>
                                    <label for='tipDocumentAdd_${j}'>tipo documento</label>
                              </td> 
                              <td>
                                <input disabled class="note" id="descripcionAdd_${j}" type="text" class="validate" value="${r[j].descripcionDocumento}">
                                <label for="descripcionAdd_${j}"></label>
                              </td>
                              <td>
                              </td>
                              <td>
                                <button data-target="modal_${j}" class="btn edit_data modal-trigger waves-effect btn-flat col m12 m12 s12 btn waves-effect primary waves-light">Abrir</button>
                                <div id="modal_${j}" class="modal modal-fixed-footer">
                                  <div class="modal-content">
                                    <img src="${r[j].urlDocumento}"
                                        alt="" class="materialboxed"
                                        style="width:100%">
                                  </div>
                                <div class="modal-footer">
                                  <a class="modal-action edit_close modal-close waves-effect waves-green btn-flat ">Close</a>
                                </div>
                              </td>
                          </tr>`)
                  $(`#tipDocumentAdd_${j}`).material_select();
                  
                  $(document).on('click', '.edit_data', function () {
                    $('.modal').modal();
                    $(`#modal_${j}`).openModal;
                  });
                  $(document).on('click', '.edit_close', function () {
                    $('.modal').modal();
                    $(`#modal_${j}`).close;
                  });
              }
          }
      })

      }else{
      $.ajax({
          method: 'GET',
          url: `/api/carguedocumento/getDocumentos/${sedeData}/${idUser}`,
          success: function (r) {   
              for(let j = 0; j < r.length; j++){
                $("#table_documentPacient").append(`
                          <tr class='tabrow closed'>
                              <td>
                                <select disabled id="tipDocumentAdd_${j}" class="validate select browse-select">
                                        <option value="" disabled selected>Elige una opción</option>
                                        <option value="FC"${r[j].tipoDocumento == 'Fotocopia de cédula (de los integrantes)' ? 'selected' : ''}>Fotocopia de cédula (de los integrantes)</option>
                                        <option value="CYA"${r[j].tipoDocumento == 'CONSENTIMIENTO Y/O ASENTIMIENTO' ? 'selected' : '' }>CONSENTIMIENTO Y/O ASENTIMIENTO</option>
                                        <option value="RDP"${r[j].tipoDocumento == 'RECIBO DE PAGO' ? 'selected' : '' }>RECIBO DE PAGO</option>
                                        <option value="HCE"${r[j].tipoDocumento == 'HISTORIA CLINICA EXTERNA' ? 'selected' : '' }>HISTORIA CLINICA EXTERNA</option>
                                        <option value="RCT"${r[j].tipoDocumento == 'TARJETA PARA MENORES DE EDAD' ? 'selected' : '' }> Y TARJETA PARA MENORES DE EDAD</option>
                                        <option value="RCT"${r[j].tipoDocumento == 'REGISTRO CIVIL' ? 'selected' : '' }>TARJETA PARA MENORES DE EDAD</option>
                                        <option value="DCC"${r[j].tipoDocumento == 'DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO.' ? 'selected' : '' }>DOCUMENTO DE CUSTODIA O DECLARACIÓN EXTRAJUICIO.</option>
                                        <option value="DIU"${r[j].tipoDocumento == 'DOCUMENTO INCRUSTADO (ESTABLECER LOS DOCUMENTOS A CARGAR DE MANERA COMPILADA EN UN SOLO ARCHIVO) ' ? 'selected' : '' }>DOCUMENTO INCRUSTADO (ESTABLECER LOS DOCUMENTOS A CARGAR DE MANERA COMPILADA EN UN SOLO ARCHIVO) </option>
                                    </select>
                                    <label for='tipDocumentAdd_${j}'>tipo documento</label>
                              </td> 
                              <td>
                                <input disabled class="note" id="descripcionAdd_${j}" type="text" class="validate" value="${r[j].descripcionDocumento}">
                                <label for="descripcionAdd_${j}"></label>
                              </td>
                              <td>
                              </td>
                              <td>
                                <button data-target="modal_${j}" class="btn edit_data modal-trigger waves-effect btn-flat col m12 m12 s12 btn waves-effect primary waves-light">Abrir</button>
                                <div id="modal_${j}" class="modal modal-fixed-footer">
                                  <div class="modal-content">
                                    <img src="${r[j].urlDocumento}"
                                        alt="" class="materialboxed"
                                        style="width:100%">
                                  </div>
                                <div class="modal-footer">
                                  <a class="modal-action edit_close modal-close waves-effect waves-green btn-flat ">Close</a>
                                </div>
                              </td>
                          </tr>`)
                  $(`#tipDocumentAdd_${j}`).material_select();
                  
                  $(document).on('click', '.edit_data', function () {
                    $('.modal').modal();
                    $(`#modal_${j}`).openModal;
                  });
                  $(document).on('click', '.edit_close', function () {
                    $('.modal').modal();
                    $(`#modal_${j}`).close;
                  });
              }
          }
      })
      }
      /* Obtener Profesionales-Docente */
      $.ajax({
          method: 'GET',
          url: `/api/profesionales/docenteSup?filter[sede]=${sedeData}&limit=1000000&projection=nombre+apellido+username+-Sedes+-Encargados+-SedeUserInfos`,
          success: function (r) {
              //console.log(">>>> terapeuta: ", r)
              for (let i = 0; i < r.length; i++) {
                  const formulario = r[i];
                  $('#dc_Asignado').append(
                      `<option value="${formulario._id}">${formulario.nombre} ${formulario.apellido}</option>`)
              }
              $('#dc_Asignado').material_select();
          }
      })



        $('#tipEdad').val('')
        var valueBirth = ($("#fecha_nacimiento").val())
        .replace('Enero', 'Jan')
        .replace('Abril', 'Apr')
        .replace('Agosto', 'Aug')
        .replace('Diciembre', 'Dec')
        
        var a = moment();
        let fech = valueBirth.split('/').reverse()
        
       var age = moment([`${fech[0]}-${fech[1]}-${fech[2]}`])
        var years = a.diff(age, 'years',false);
        let rango = '';
        if(years >= 0){
            if (years < 6) { 
                rango = "PRIMERA INFANCIA"
            } else if (years < 12) {
                rango = "INFANCIA"
            } else if (years < 18) {
                rango = "ADOLESCENCIA"
            } else if (years < 27) {
                rango = "JUVENTUD"
            } else if (years < 61) {
                rango = "ADULTEZ"
            } else {
                rango = "ADULTEZ MAYOR"
            }
            $('#tipEdad').val(`${rango}`)
        }
        
        $('#edad').val(`${years} años`)
      })
         

      function getMunicipios(codigoDepa) {
        return Municipios.filter(function(muni){
            return muni.Cod_depa == codigoDepa

        })
    }
    function getCantones(codProv) {
         return Cantones.filter(function(can){
             return can.Codigo_prov == codProv
         })
     }
           /* Obtener Resumen de historia clicnica */
           function remitir (){
            let profesional = <%- JSON.stringify(paciente.idProfesional) || '{}' %>;
            let idUser = $("#user_id").val() || null;
            let sedeData = $("#sedesRecepcion").val();
            var confirmacion = confirm("¿Quieres reasignar este caso?")
            if(confirmacion == true){
              $.ajax({
                url: `/api/citas/getCitasSedeProfePaciente/${sedeData}/${profesional}/${idUser}`,
                method: 'GET',
                success: function (r) {
                  var nuevaCita =[]
                for(i=0;i<r.length;i++){
                  var citas = r[i]
                  citas.estado = 'Cancelada',
                  citas.color = '#d21807'
                   nuevaCita.push(citas)
                }console.log(nuevaCita)

                for(j=0;j<nuevaCita.length;j++){
                  var urlEnvio = `/api/citas/cancelarCitasU/${nuevaCita[j]._id}`
                  var methodEnvio = 'PATCH'
                  $.ajax({
                    url: urlEnvio,
                    method: methodEnvio,
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify(nuevaCita[j]),
                    success: function () {
                        Materialize.toast('Cita reprogramada con éxito.', 1000, 'rounded green')
                       
                        
                    },
                    error: function (a, b, c) {
                        console.log(a, b, c);
                        Materialize.toast(
                            'Hubo un error en los datos proporcionados. Verifica e inténtalo de nuevo.',
                            4000, 'rounded red');
                    }
                })
                }

                location.href = `/citas/indexUni?sede=${sedeData}&paciente=${idUser}`
               }         
              })  
                                    
            }      
           }
      
</script>


<% include  ../../view_distribution/bot2.ejs%>